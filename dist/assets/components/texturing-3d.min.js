!function(){var t=X3D.define;X3D.require;t("x_ite/Components/Texturing3D/X3DTexture3DNode",["x_ite/Components/Texturing/X3DTextureNode","x_ite/Bits/X3DConstants","x_ite/Bits/X3DCast"],function(t,e,i){"use strict";function n(i){t.call(this,i),this.addType(e.X3DTexture3DNode),this.width=0,this.height=0,this.depth=0,this.data=null}var r=new Uint8Array([255,255,255,255]);return n.prototype=Object.assign(Object.create(t.prototype),{constructor:n,initialize:function(){t.prototype.initialize.call(this);var e=this.getBrowser().getContext();e.getVersion()<2||(this.target=e.TEXTURE_3D,this.repeatS_.addInterest("updateTextureProperties",this),this.repeatT_.addInterest("updateTextureProperties",this),this.repeatR_.addInterest("updateTextureProperties",this),this.textureProperties_.addInterest("set_textureProperties__",this),e.bindTexture(e.TEXTURE_3D,this.getTexture()),e.texImage3D(e.TEXTURE_3D,0,e.RGBA,1,1,1,0,e.RGBA,e.UNSIGNED_BYTE,r),this.set_textureProperties__())},set_textureProperties__:function(){this.texturePropertiesNode&&this.texturePropertiesNode.removeInterest("updateTextureProperties",this),this.texturePropertiesNode=i(e.TextureProperties,this.textureProperties_),this.texturePropertiesNode||(this.texturePropertiesNode=this.getBrowser().getDefaultTextureProperties()),this.texturePropertiesNode.addInterest("updateTextureProperties",this),this.updateTextureProperties()},getTarget:function(){return this.target},getWidth:function(){return this.width},getHeight:function(){return this.height},getDepth:function(){return this.depth},getFlipY:function(){return!1},getData:function(){return this.data},clearTexture:function(){var t=this.getBrowser().getContext();this.setTexture(1,1,1,!1,t.RGBA,r)},setTexture:function(t,e,i,n,r,s){try{this.width=t,this.height=e,this.depth=i,this.data=s;var o=this.getBrowser().getContext();if(o.getVersion()<2)return;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1),o.pixelStorei(o.UNPACK_ALIGNMENT,1),o.bindTexture(o.TEXTURE_3D,this.getTexture()),o.texImage3D(o.TEXTURE_3D,0,r,t,e,i,0,r,o.UNSIGNED_BYTE,s),this.setTransparent(n),this.updateTextureProperties(),this.addNodeEvent()}catch(t){}},updateTextureProperties:function(){var e=this.getBrowser().getContext();t.prototype.updateTextureProperties.call(this,e.TEXTURE_3D,this.textureProperties_.getValue(),this.texturePropertiesNode,this.width,this.height,this.repeatS_.getValue(),this.repeatT_.getValue(),this.repeatR_.getValue())},setShaderUniformsToChannel:function(t,e,i){t.getVersion()>=2&&(t.activeTexture(t.TEXTURE0+e.getBrowser().getTexture3DUnits()[i]),t.bindTexture(t.TEXTURE_3D,this.getTexture())),t.uniform1i(e.x3d_TextureType[i],3)}}),n}),t("x_ite/Components/Texturing3D/ComposedTexture3D",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Texturing3D/X3DTexture3DNode","x_ite/Bits/X3DConstants","x_ite/Bits/X3DCast"],function(t,e,i,n,r,s){"use strict";function o(e){n.call(this,e),this.addType(r.ComposedTexture3D),this.addChildObjects("loadState",new t.SFInt32(r.NOT_STARTED_STATE)),this.textureNodes=[]}return o.prototype=Object.assign(Object.create(n.prototype),{constructor:o,fieldDefinitions:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.initializeOnly,"repeatS",new t.SFBool),new e(r.initializeOnly,"repeatT",new t.SFBool),new e(r.initializeOnly,"repeatR",new t.SFBool),new e(r.initializeOnly,"textureProperties",new t.SFNode),new e(r.inputOutput,"texture",new t.MFNode)]),getTypeName:function(){return"ComposedTexture3D"},getComponentName:function(){return"Texturing3D"},getContainerField:function(){return"texture"},initialize:function(){n.prototype.initialize.call(this),this.texture_.addInterest("set_texture__",this),this.set_texture__()},checkLoadState:function(){return this.loadState_.getValue()},set_texture__:function(){for(var t=this.textureNodes,e=0,i=t.length;e<i;++e)t[e].removeInterest("update",this);t.length=0;for(var e=0,i=this.texture_.length;e<i;++e){var n=s(r.X3DTexture2DNode,this.texture_[e]);n&&t.push(n)}for(var e=0,i=t.length;e<i;++e)t[e].addInterest("update",this);this.update()},update:function(){for(var t=this.textureNodes,e=0,i=0,n=t.length;i<n;++i)e+=t[i].checkLoadState()===r.COMPLETE_STATE;if(0===t.length||e!==t.length)this.clearTexture(),this.loadState_=r.FAILED_STATE;else{for(var s=this.getBrowser().getContext(),o=t[0],a=o.getWidth(),u=o.getHeight(),h=t.length,d=0,c=a*u*4,p=new Uint8Array(c*h),i=0,l=0;i<h;++i){var g=this.textureNodes[i],x=g.getData();d+=g.getTransparent();for(var f=0;f<c;++f,++l)p[l]=x[f]}this.setTexture(a,u,h,!!d,s.RGBA,p),this.loadState_=r.COMPLETE_STATE}}}),o}),t("x_ite/Browser/Texturing3D/NRRDParser",["pako_inflate"],function(t){"use strict";function e(t){return this.lastIndex=t.lastIndex,t.result=this.exec(t.input),!!t.result&&(t.lastIndex=this.lastIndex,!0)}function i(){this.fieldFunction=new Map([["type",this.type],["encoding",this.encoding],["dimension",this.dimension],["sizes",this.sizes]])}var n={NRRD:new RegExp("^NRRD(\\d+)\\n","gy"),field:new RegExp("(\\w+):\\s*(.+?)\\n","gy"),comment:new RegExp("#[^\\n]\\n","gy"),newLine:new RegExp("\n","gy"),data:new RegExp("([^]*)$","gy")};for(var r in n)n[r].parse=e;return i.prototype={parse:function(t){return this.setInput(t),this.NRRD(),this.fields(),this.data(),this.nrrd},setInput:function(t){this.input=t,this.lastIndex=0,this.nrrd={}},NRRD:function(){if(n.NRRD.parse(this))return void(this.nrrd.version=parseInt(this.result[1]));throw new Error("Invalid NRRD file.")},fields:function(){for(;n.comment.parse(this););for(;n.field.parse(this);){var t=this.result[1],e=this.result[2].trim().toLowerCase(),i=this.fieldFunction.get(t.toLowerCase());for(i&&i.call(this,e);n.comment.parse(this););}},type:function(){var t=new Map([["signed char",["signed char",1]],["int8",["signed char",1]],["int8_t",["signed char",1]],["uchar",["unsigned char",1]],["unsigned char",["unsigned char",1]],["uint8",["unsigned char",1]],["uint8_t",["unsigned char",1]],["short",["signed short",2]],["short int",["signed short",2]],["signed short",["signed short",2]],["signed short int",["signed short",2]],["int16",["signed short",2]],["int16_t",["signed short",2]],["ushort",["unsigned short",2]],["unsigned short",["unsigned short",2]],["unsigned short int",["unsigned short",2]],["uint16",["unsigned short",2]],["uint16_t",["unsigned short",2]],["int",["signed int",4]],["signed int",["signed int",4]],["int32",["signed int",4]],["int32_t",["signed int",4]],["uint",["unsigned int",4]],["unsigned int",["unsigned int",4]],["uint32",["unsigned int",4]],["uint32_t",["unsigned int",4]],["float",["float",4]],["double",["double",8]]]);return function(e){var i=t.get(e);if(void 0===i)throw new Error("Unsupported NRRD type '"+e+"'.");this.byteType=i[0],this.bytes=i[1]}}(),encoding:function(){var t=new Map([["ascii","ascii"],["txt","ascii"],["text","ascii"],["raw","raw"],["hex","hex"],["gz","gzip"],["gzip","gzip"]]);return function(e){var i=t.get(e);if(void 0===i)throw new Error("Unsupported NRRD encoding '"+e+"'.");this.encoding=i}}(),dimension:function(t){var e=t.match(/(\d+)/);if(e){var i=parseInt(e[1]);switch(i){case 3:case 4:return void(this.nrrd.dimension=i);default:throw new Error("Unsupported NRRD dimension '"+i+"', must be 3.")}}throw new Error("Unsupported NRRD dimension, must be 3 or 4.")},sizes:function(t){for(var e=new RegExp("\\s*(\\d+)","gy"),i=null,n=[];i=e.exec(t);)n.push(parseInt(i[1]));switch(n.length){case 3:return this.nrrd.components=1,this.nrrd.width=n[0],this.nrrd.height=n[1],void(this.nrrd.depth=n[2]);case 4:return this.nrrd.components=n[0],this.nrrd.width=n[1],this.nrrd.height=n[2],void(this.nrrd.depth=n[3]);default:throw new Error("Unsupported NRRD sizes.")}},data:function(){switch(this.encoding){case"ascii":this.ascii();break;case"raw":this.raw();break;case"hex":this.hex();break;case"gzip":this.gzip()}},ascii:function(){var t=this.nrrd.components*this.nrrd.width*this.nrrd.height*this.nrrd.depth,e=new Uint8Array(t);if(this.nrrd.data=e,n.data.parse(this)){var i=this.result[1].trim().split(/\s+/);switch(this.byteType){case"signed char":case"unsigned char":return void i.forEach(function(t,i){e[i]=parseInt(t)});case"signed short":case"unsigned short":return void i.forEach(function(t,i){e[i]=parseInt(t)/256});case"signed int":case"unsigned int":return void i.forEach(function(t,i){e[i]=parseInt(t)/16777216});case"float":case"double":return void i.forEach(function(t,i){e[i]=255*parseFloat(t)})}}},raw:function(){var t=this.input,e=this.nrrd.components*this.nrrd.width*this.nrrd.height*this.nrrd.depth,i=e*this.bytes,n=new Uint8Array(e);switch(this.nrrd.data=n,this.byteType){case"signed char":case"unsigned char":for(var r=t.length-i,s=0;r<t.length;++r,++s)n[s]=t.charCodeAt(r);return;case"signed short":case"unsigned short":for(var r=t.length-i,s=0;r<t.length;r+=2,++s)n[s]=(t.charCodeAt(r)<<8|t.charCodeAt(r+1))/256;return;case"signed int":case"unsigned int":for(var r=t.length-i,s=0;r<t.length;r+=4,++s)n[s]=(t.charCodeAt(r)<<24|t.charCodeAt(r+1)<<16|t.charCodeAt(r+2)<<8|t.charCodeAt(r+3))/16777216;return;case"float":for(var r=t.length-i,s=0;r<t.length;r+=4,++s)n[s]=this.float2byte(t.charCodeAt(r),t.charCodeAt(r+1),t.charCodeAt(r+2),t.charCodeAt(r+3));return;case"double":for(var r=t.length-i,s=0;r<t.length;r+=8,++s)n[s]=this.double2byte(t.charCodeAt(r),t.charCodeAt(r+1),t.charCodeAt(r+2),t.charCodeAt(r+3),t.charCodeAt(r+4),t.charCodeAt(r+5),t.charCodeAt(r+6),t.charCodeAt(r+7));return}},hex:function(){n.data.parse(this);var t=this.result[1].replace(/\s+/,"").match(/([0-9a-f]{2})/gi).map(function(t){return parseInt(t,16)});this.input=String.fromCharCode.apply(String,t),this.raw()},gzip:function(){if(!n.newLine.parse(this))throw new Error("Invalid NRRD data.");n.data.parse(this);var e=t.ungzip(this.result[1],{to:"raw"});this.input=String.fromCharCode.apply(String,e),this.raw()},float2byte:function(){var t=new Uint8Array(4),e=new Float32Array(t.buffer);return function(i,n,r,s){return t[0]=i,t[1]=n,t[2]=r,t[3]=s,255*e[0]}}(),double2byte:function(){var t=new Uint8Array(8),e=new Float64Array(t.buffer);return function(i,n,r,s,o,a,u,h){return t[0]=i,t[1]=n,t[2]=r,t[3]=s,t[4]=o,t[5]=a,t[6]=u,t[7]=h,255*e[0]}}()},i}),t("x_ite/Components/Texturing3D/ImageTexture3D",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Texturing3D/X3DTexture3DNode","x_ite/Components/Networking/X3DUrlObject","x_ite/Bits/X3DConstants","x_ite/Browser/Texturing3D/NRRDParser","x_ite/InputOutput/FileLoader"],function(t,e,i,n,r,s,o,a){"use strict";function u(e){n.call(this,e),r.call(this,e),this.addType(s.ImageTexture3D),this.addChildObjects("buffer",new t.MFString)}return u.prototype=Object.assign(Object.create(n.prototype),r.prototype,{constructor:u,fieldDefinitions:new i([new e(s.inputOutput,"metadata",new t.SFNode),new e(s.inputOutput,"url",new t.MFString),new e(s.initializeOnly,"repeatS",new t.SFBool),new e(s.initializeOnly,"repeatT",new t.SFBool),new e(s.initializeOnly,"repeatR",new t.SFBool),new e(s.initializeOnly,"textureProperties",new t.SFNode)]),getTypeName:function(){return"ImageTexture3D"},getComponentName:function(){return"Texturing3D"},getContainerField:function(){return"texture"},initialize:function(){n.prototype.initialize.call(this),r.prototype.initialize.call(this),this.url_.addInterest("set_url__",this),this.buffer_.addInterest("set_buffer__",this),this.set_url__()},set_url__:function(){this.setLoadState(s.NOT_STARTED_STATE),this.requestAsyncLoad()},requestAsyncLoad:function(){this.checkLoadState()!==s.COMPLETE_STATE&&this.checkLoadState()!==s.IN_PROGRESS_STATE&&(this.setLoadState(s.IN_PROGRESS_STATE),this.buffer_=this.url_)},getInternalType:function(t,e){switch(e){case 1:return t.LUMINANCE;case 2:return t.LUMINANCE_ALPHA;case 3:return t.RGB;case 4:return t.RGBA}},set_buffer__:function(){new a(this).loadBinaryDocument(this.buffer_,function(t){if(null===t)this.setLoadState(s.FAILED_STATE),this.clearTexture();else{var e=this.getBrowser().getContext(),i=(new o).parse(t),n=this.getInternalType(e,i.components);this.setTexture(i.width,i.height,i.depth,!1,n,i.data),this.setLoadState(s.COMPLETE_STATE)}}.bind(this))}}),u}),t("x_ite/Components/Texturing3D/PixelTexture3D",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Texturing3D/X3DTexture3DNode","x_ite/Bits/X3DConstants"],function(t,e,i,n,r){"use strict";function s(e){n.call(this,e),this.addType(r.PixelTexture3D),this.addChildObjects("loadState",new t.SFInt32(r.NOT_STARTED_STATE))}return s.prototype=Object.assign(Object.create(n.prototype),{constructor:s,fieldDefinitions:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.inputOutput,"image",new t.MFInt32(0,0,0,0)),new e(r.initializeOnly,"repeatS",new t.SFBool),new e(r.initializeOnly,"repeatT",new t.SFBool),new e(r.initializeOnly,"repeatR",new t.SFBool),new e(r.initializeOnly,"textureProperties",new t.SFNode)]),getTypeName:function(){return"PixelTexture3D"},getComponentName:function(){return"Texturing3D"},getContainerField:function(){return"texture"},initialize:function(){n.prototype.initialize.call(this),this.image_.addInterest("set_image__",this),this.set_image__()},checkLoadState:function(){return this.loadState_.getValue()},set_image__:function(){return function(){var t=this.image_;if(t.length<4)return this.clearTexture(),void(this.loadState_=r.FAILED_STATE);var e=this.getBrowser().getContext(),i=t[0],n=t[1],s=t[2],o=t[3],a=!(1&i),u=n*s*o;switch(i){case 1:for(var h=e.LUMINANCE,d=new Uint8Array(u),c=4,p=4+u,l=0;c<p;++c)d[l++]=t[c];break;case 2:for(var h=e.LUMINANCE_ALPHA,d=new Uint8Array(2*u),c=4,p=4+u,l=0;c<p;++c){var g=t[c];d[l++]=g>>>8&255,d[l++]=255&g}break;case 3:for(var h=e.RGB,d=new Uint8Array(3*u),c=4,p=4+u,l=0;c<p;++c){var g=t[c];d[l++]=g>>>16&255,d[l++]=g>>>8&255,d[l++]=255&g}break;case 4:for(var h=e.RGBA,d=new Uint8Array(4*u),c=4,p=4+u,l=0;c<p;++c){var g=t[c];d[l++]=g>>>24&255,d[l++]=g>>>16&255,d[l++]=g>>>8&255,d[l++]=255&g}break;default:return this.clearTexture(),void(this.loadState_=r.FAILED_STATE)}this.setTexture(n,s,o,a,h,d),this.loadState_=r.COMPLETE_STATE}}()}),s}),t("x_ite/Components/Texturing3D/TextureCoordinate3D",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Texturing/X3DTextureCoordinateNode","x_ite/Bits/X3DConstants"],function(t,e,i,n,r){"use strict";function s(t){n.call(this,t),this.addType(r.TextureCoordinate3D)}return s.prototype=Object.assign(Object.create(n.prototype),{constructor:s,fieldDefinitions:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.inputOutput,"point",new t.MFVec3f)]),getTypeName:function(){return"TextureCoordinate3D"},getComponentName:function(){return"Texturing3D"},getContainerField:function(){return"texCoord"},initialize:function(){n.prototype.initialize.call(this),this.point_.addInterest("set_point__",this),this.set_point__()},set_point__:function(){this.point=this.point_.getValue(),this.length=this.point_.length},isEmpty:function(){return 0===this.length},getSize:function(){return this.length},get1Point:function(t,e){if(t<this.length){const i=this.point;return t*=3,e.set(i[t],i[t+1],i[t+2],1)}return e.set(0,0,0,1)},addTexCoordToChannel:function(t,e){if(t>=0&&t<this.length){var i=this.point;t*=3,e.push(i[t],i[t+1],i[t+2],1)}else e.push(0,0,0,1)},getTexCoord:function(t){for(var e=this.point_,i=0,n=e.length;i<n;++i){var r=e[i];t[i]=new Vector4(r.x,r.y,r.z,1)}return t.length=n,t}}),s}),t("x_ite/Components/Texturing3D/TextureCoordinate4D",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Texturing/X3DTextureCoordinateNode","x_ite/Bits/X3DConstants"],function(t,e,i,n,r){"use strict";function s(t){n.call(this,t),this.addType(r.TextureCoordinate4D)}return s.prototype=Object.assign(Object.create(n.prototype),{constructor:s,fieldDefinitions:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.inputOutput,"point",new t.MFVec4f)]),getTypeName:function(){return"TextureCoordinate4D"},getComponentName:function(){return"Texturing3D"},getContainerField:function(){return"texCoord"},initialize:function(){n.prototype.initialize.call(this),this.point_.addInterest("set_point__",this),this.set_point__()},set_point__:function(){this.point=this.point_.getValue(),this.length=this.point_.length},isEmpty:function(){return 0===this.length},getSize:function(){return this.length},get1Point:function(t,e){if(t<this.length){const i=this.point;return t*=4,e.set(i[t],i[t+1],i[t+2],i[t+3])}return e.set(0,0,0,1)},addTexCoordToChannel:function(t,e){if(t>=0&&t<this.length){var i=this.point;t*=4,e.push(i[t],i[t+1],i[t+2],i[t+3])}else e.push(0,0,0,1)},getTexCoord:function(t){for(var e=this.point_,i=0,n=e.length;i<n;++i){var r=e[i];t[i]=new Vector4(r.x,r.y,r.z,r.w)}return t.length=n,t}}),s}),t("x_ite/Components/Texturing3D/TextureTransform3D",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Texturing/X3DTextureTransformNode","x_ite/Bits/X3DConstants","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4"],function(t,e,i,n,r,s,o){"use strict";function a(t){n.call(this,t),this.addType(r.TextureTransform3D)}var u=new s(0,0,0);return a.prototype=Object.assign(Object.create(n.prototype),{constructor:a,fieldDefinitions:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.inputOutput,"translation",new t.SFVec3f),new e(r.inputOutput,"rotation",new t.SFRotation),new e(r.inputOutput,"scale",new t.SFVec3f(1,1,1)),new e(r.inputOutput,"center",new t.SFVec3f)]),getTypeName:function(){return"TextureTransform3D"},getComponentName:function(){return"Texturing3D"},getContainerField:function(){return"textureTransform"},initialize:function(){n.prototype.initialize.call(this),this.addInterest("eventsProcessed",this),this.eventsProcessed()},eventsProcessed:function(){var t=this.translation_.getValue(),e=this.rotation_.getValue(),i=this.scale_.getValue(),n=this.center_.getValue(),r=this.getMatrix();r.identity(),n.equals(s.Zero)||r.translate(u.assign(n).negate()),i.equals(s.One)||r.scale(i),e.equals(o.Identity)||r.rotate(e),n.equals(s.Zero)||r.translate(n),t.equals(s.Zero)||r.translate(t),this.setMatrix(r)}}),a}),t("x_ite/Components/Texturing3D/TextureTransformMatrix3D",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Texturing/X3DTextureTransformNode","x_ite/Bits/X3DConstants"],function(t,e,i,n,r){"use strict";function s(t){n.call(this,t),this.addType(r.TextureTransformMatrix3D)}return s.prototype=Object.assign(Object.create(n.prototype),{constructor:s,fieldDefinitions:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.inputOutput,"matrix",new t.SFMatrix4f(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1))]),getTypeName:function(){return"TextureTransformMatrix3D"},getComponentName:function(){return"Texturing3D"},getContainerField:function(){return"textureTransform"},ininitialize:function(){n.prototype.ininitialize.call(this),this.addInterest("eventsProcessed",this),this.eventsProcessed()},eventsProcessed:function(){var t=this.getMatrix();t.assign(this.matrix_.getValue()),this.setMatrix(t)}}),s}),t(["x_ite/Components","x_ite/Components/Texturing3D/ComposedTexture3D","x_ite/Components/Texturing3D/ImageTexture3D","x_ite/Components/Texturing3D/PixelTexture3D","x_ite/Components/Texturing3D/TextureCoordinate3D","x_ite/Components/Texturing3D/TextureCoordinate4D","x_ite/Components/Texturing3D/TextureTransform3D","x_ite/Components/Texturing3D/TextureTransformMatrix3D","x_ite/Components/Texturing3D/X3DTexture3DNode"],function(t,e,i,n,r,s,o,a,u){"use strict";t.addComponent({name:"Texturing3D",types:{ComposedTexture3D:e,ImageTexture3D:i,PixelTexture3D:n,TextureCoordinate3D:r,TextureCoordinate4D:s,TextureTransform3D:o,TextureTransformMatrix3D:a},abstractTypes:{X3DTexture3DNode:u}})})}();
