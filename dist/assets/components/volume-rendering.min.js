!function(){var e=X3D.define;X3D.require;e("x_ite/Components/VolumeRendering/X3DVolumeRenderStyleNode",["x_ite/Components/Core/X3DNode","x_ite/Bits/X3DConstants"],function(e,t){"use strict";function n(n){e.call(this,n),this.addType(t.X3DVolumeRenderStyleNode)}return n.prototype=Object.assign(Object.create(e.prototype),{constructor:n,addShaderFields:function(e){},getUniformsText:function(){return""},getFunctionsText:function(){return""}}),n}),e("x_ite/Components/VolumeRendering/X3DComposableVolumeRenderStyleNode",["x_ite/Components/VolumeRendering/X3DVolumeRenderStyleNode","x_ite/Bits/X3DConstants"],function(e,t){"use strict";function n(n){e.call(this,n),this.addType(t.X3DComposableVolumeRenderStyleNode)}return n.prototype=Object.assign(Object.create(e.prototype),{constructor:n}),n}),e("x_ite/Components/VolumeRendering/OpacityMapVolumeStyle",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/VolumeRendering/X3DComposableVolumeRenderStyleNode","x_ite/Bits/X3DConstants","x_ite/Bits/X3DCast"],function(e,t,n,o,i,r){"use strict";function s(e){o.call(this,e),this.addType(i.OpacityMapVolumeStyle)}return s.prototype=Object.assign(Object.create(o.prototype),{constructor:s,fieldDefinitions:new n([new t(i.inputOutput,"enabled",new e.SFBool(!0)),new t(i.inputOutput,"metadata",new e.SFNode),new t(i.inputOutput,"transferFunction",new e.SFNode)]),getTypeName:function(){return"OpacityMapVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"},initialize:function(){o.prototype.initialize.call(this),this.getBrowser().getContext().getVersion()<2||(this.transferFunction_.addInterest("set_transferFunction__",this),this.set_transferFunction__())},set_transferFunction__:function(){this.transferFunctionNode=r(i.X3DTexture2DNode,this.transferFunction_),this.transferFunctionNode||(this.transferFunctionNode=this.getBrowser().getDefaultTransferFunction())},addShaderFields:function(t){t.addUserDefinedField(i.inputOutput,"transferFunction_"+this.getId(),new e.SFNode(this.transferFunctionNode))},getUniformsText:function(){return"uniform sampler2D transferFunction_"+this.getId()+";\n"},getFunctionsText:function(){return"\ttextureColor = texture (transferFunction_"+this.getId()+", textureColor .ra);\n"}}),s}),e("x_ite/Browser/VolumeRendering/X3DVolumeRenderingContext",["x_ite/Components/Texturing/PixelTexture","x_ite/Components/Texturing/TextureProperties","x_ite/Components/VolumeRendering/OpacityMapVolumeStyle"],function(e,t,n){"use strict";function o(){}return o.prototype={getDefaultVolumeStyle:function(){return void 0!==this.defaultVolumeStyle?this.defaultVolumeStyle:(this.defaultVolumeStyle=new n(this.getPrivateScene()),this.defaultVolumeStyle.setup(),this.defaultVolumeStyle)},getDefaultTransferFunction:function(){if(void 0!==this.defaultTransferFunction)return this.defaultTransferFunction;this.defaultTransferFunction=new e(this.getPrivateScene());var n=new t(this.getPrivateScene());n.generateMipMaps_=!0,n.boundaryModeS_="CLAMP_TO_EDGE",n.boundaryModeT_="REPEAT",this.defaultTransferFunction.textureProperties_=n,this.defaultTransferFunction.image_.width=256,this.defaultTransferFunction.image_.height=1,this.defaultTransferFunction.image_.comp=2;for(var o=this.defaultTransferFunction.image_.array,i=0;i<256;++i)o[i]=i<<8|i;return n.setup(),this.defaultTransferFunction.setup(),this.defaultTransferFunction}},o}),e("x_ite/Components/VolumeRendering/BlendedVolumeStyle",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/VolumeRendering/X3DComposableVolumeRenderStyleNode","x_ite/Bits/X3DConstants","x_ite/Bits/X3DCast"],function(e,t,n,o,i,r){"use strict";function s(e){o.call(this,e),this.addType(i.BlendedVolumeStyle)}return s.prototype=Object.assign(Object.create(o.prototype),{constructor:s,fieldDefinitions:new n([new t(i.inputOutput,"metadata",new e.SFNode),new t(i.inputOutput,"enabled",new e.SFBool(!0)),new t(i.inputOutput,"weightConstant1",new e.SFFloat(.5)),new t(i.inputOutput,"weightConstant2",new e.SFFloat(.5)),new t(i.inputOutput,"weightFunction1",new e.SFString("CONSTANT")),new t(i.inputOutput,"weightFunction2",new e.SFString("CONSTANT")),new t(i.inputOutput,"weightTransferFunction1",new e.SFNode),new t(i.inputOutput,"weightTransferFunction2",new e.SFNode),new t(i.inputOutput,"renderStyle",new e.SFNode),new t(i.inputOutput,"voxels",new e.SFNode)]),getTypeName:function(){return"BlendedVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"},initialize:function(){o.prototype.initialize.call(this),this.getBrowser().getContext().getVersion()<2||(this.weightTransferFunction1_.addInterest("set_weightTransferFunction1__",this),this.weightTransferFunction2_.addInterest("set_weightTransferFunction2__",this),this.renderStyle_.addInterest("set_renderStyle__",this),this.voxels_.addInterest("set_voxels__",this),this.set_weightTransferFunction1__(),this.set_weightTransferFunction2__(),this.set_renderStyle__(),this.set_voxels__())},set_weightTransferFunction1__:function(){this.weightTransferFunction1Node=r(i.X3DTexture2DNode,this.weightTransferFunction1_)},set_weightTransferFunction2__:function(){this.weightTransferFunction2Node=r(i.X3DTexture2DNode,this.weightTransferFunction2_)},set_renderStyle__:function(){this.renderStyleNode&&this.renderStyleNode.removeInterest("addNodeEvent",this),this.renderStyleNode=r(i.X3DComposableVolumeRenderStyleNode,this.renderStyle_),this.renderStyleNode||(this.renderStyleNode=this.getBrowser().getDefaultVolumeStyle()),this.renderStyleNode&&this.renderStyleNode.addInterest("addNodeEvent",this)},set_voxels__:function(){this.voxelsNode&&this.voxelsNode.removeInterest("set_textureSize__",this),this.voxelsNode=r(i.X3DTexture3DNode,this.voxels_),this.voxelsNode&&(this.voxelsNode.addInterest("set_textureSize__",this),this.set_textureSize__())},set_textureSize__:function(){var e=this.textureSize;e&&(e.x=this.voxelsNode.getWidth(),e.y=this.voxelsNode.getHeight(),e.z=this.voxelsNode.getDepth())},addShaderFields:function(t){t.addUserDefinedField(i.inputOutput,"weightConstant1_"+this.getId(),this.weightConstant1_.copy()),t.addUserDefinedField(i.inputOutput,"weightConstant2_"+this.getId(),this.weightConstant2_.copy()),this.weightTransferFunction1Node&&t.addUserDefinedField(i.inputOutput,"weightTransferFunction1_"+this.getId(),new e.SFNode(this.weightTransferFunction1Node)),this.weightTransferFunction2Node&&t.addUserDefinedField(i.inputOutput,"weightTransferFunction2_"+this.getId(),new e.SFNode(this.weightTransferFunction2Node)),this.voxelsNode?(this.textureSize=new e.SFVec3f(this.voxelsNode.getWidth(),this.voxelsNode.getHeight(),this.voxelsNode.getDepth()),t.addUserDefinedField(i.inputOutput,"voxels_"+this.getId(),new e.SFNode(this.voxelsNode)),t.addUserDefinedField(i.inputOutput,"textureSize_"+this.getId(),this.textureSize)):this.textureSize=null,this.renderStyleNode.addShaderFields(t)},getUniformsText:function(){if(!this.voxelsNode)return"";var e="";e+="\n",e+="// BlendedVolumeStyle\n",e+="\n",e+="uniform float     weightConstant1_"+this.getId()+";\n",e+="uniform float     weightConstant2_"+this.getId()+";\n",this.weightTransferFunction1Node&&(e+="uniform sampler2D weightTransferFunction1_"+this.getId()+";\n"),this.weightTransferFunction2Node&&(e+="uniform sampler2D weightTransferFunction2_"+this.getId()+";\n"),e+="uniform sampler3D voxels_"+this.getId()+";\n",e+="uniform vec3      textureSize_"+this.getId()+";\n";var t=this.renderStyleNode.getUniformsText();return t=t.replace(/x3d_Texture3D \[0\]/g,"voxels_"+this.getId()),t=t.replace(/x3d_TextureSize/g,"textureSize_"+this.getId()),e+="\n",e+=t},getFunctionsText:function(){if(!this.voxelsNode)return"";var e="";e+="\n",e+="\t// BlendedVolumeStyle\n",e+="\n",e+="\tvec4 blendColor_"+this.getId()+" = texture (voxels_"+this.getId()+", texCoord);";var t=this.renderStyleNode.getFunctionsText();switch(t=t.replace(/textureColor/g,"blendColor_"+this.getId()),e+="\n",e+=t,e+="\n",e+="\t// BlendedVolumeStyle\n",e+="\n",this.weightFunction1_.getValue()){default:e+="\tfloat w1_"+this.getId()+" = weightConstant1_"+this.getId()+";\n";break;case"ALPHA1":e+="\tfloat w1_"+this.getId()+" = textureColor .a;\n";break;case"ALPHA2":e+="\tfloat w1_"+this.getId()+" = blendColor_ "+this.getId()+" .a;\n";break;case"ONE_MINUS_ALPHA1":e+="\tfloat w1_"+this.getId()+" = 1.0 - textureColor .a;\n";break;case"ONE_MINUS_ALPHA2":e+="\tfloat w1_"+this.getId()+" = 1.0 - blendColor_ "+this.getId()+" .a;\n";break;case"TABLE":e+=this.weightTransferFunction1Node?"\tfloat w1_"+this.getId()+" = texture (weightTransferFunction1_"+this.getId()+", vec2 (textureColor .a, blendColor_"+this.getId()+" .a)) .r;\n":"\tfloat w1_"+this.getId()+" = weightConstant1_"+this.getId()+";\n"}switch(this.weightFunction2_.getValue()){default:e+="\tfloat w2_"+this.getId()+" = weightConstant2_"+this.getId()+";\n";break;case"ALPHA1":e+="\tfloat w2_"+this.getId()+" = textureColor .a;\n";break;case"ALPHA2":e+="\tfloat w2_"+this.getId()+" = blendColor_ "+this.getId()+" .a;\n";break;case"ONE_MINUS_ALPHA1":e+="\tfloat w2_"+this.getId()+" = 1.0 - textureColor .a;\n";break;case"ONE_MINUS_ALPHA2":e+="\tfloat w2_"+this.getId()+" = 1.0 - blendColor_ "+this.getId()+" .a;\n";break;case"TABLE":e+=this.weightTransferFunction2Node?"\tfloat w2_"+this.getId()+" = texture (weightTransferFunction2_"+this.getId()+", vec2 (textureColor .a, blendColor_"+this.getId()+" .a)) .r;\n":"\tfloat w2_"+this.getId()+" = weightConstant2_"+this.getId()+";\n"}return e+="\ttextureColor = clamp (textureColor * w1_"+this.getId()+" + blendColor_"+this.getId()+" * w2_"+this.getId()+", 0.0, 1.0);\n"}}),s}),e("x_ite/Components/VolumeRendering/BoundaryEnhancementVolumeStyle",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/VolumeRendering/X3DComposableVolumeRenderStyleNode","x_ite/Bits/X3DConstants"],function(e,t,n,o,i){"use strict";function r(e){o.call(this,e),this.addType(i.BoundaryEnhancementVolumeStyle)}return r.prototype=Object.assign(Object.create(o.prototype),{constructor:r,fieldDefinitions:new n([new t(i.inputOutput,"boundaryOpacity",new e.SFFloat(.9)),new t(i.inputOutput,"enabled",new e.SFBool(!0)),new t(i.inputOutput,"metadata",new e.SFNode),new t(i.inputOutput,"opacityFactor",new e.SFFloat(2)),new t(i.inputOutput,"retainedOpacity",new e.SFFloat(.2))]),getTypeName:function(){return"BoundaryEnhancementVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"}}),r}),e("x_ite/Components/VolumeRendering/CartoonVolumeStyle",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/VolumeRendering/X3DComposableVolumeRenderStyleNode","x_ite/Bits/X3DConstants"],function(e,t,n,o,i){"use strict";function r(e){o.call(this,e),this.addType(i.CartoonVolumeStyle)}return r.prototype=Object.assign(Object.create(o.prototype),{constructor:r,fieldDefinitions:new n([new t(i.inputOutput,"colorSteps",new e.SFInt32(4)),new t(i.inputOutput,"enabled",new e.SFBool(!0)),new t(i.inputOutput,"metadata",new e.SFNode),new t(i.inputOutput,"orthogonalColor",new e.SFColorRGBA(1,1,1,1)),new t(i.inputOutput,"parallelColor",new e.SFColorRGBA(0,0,0,1)),new t(i.inputOutput,"surfaceNormals",new e.SFNode)]),getTypeName:function(){return"CartoonVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"}}),r}),e("x_ite/Components/VolumeRendering/ComposedVolumeStyle",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/VolumeRendering/X3DComposableVolumeRenderStyleNode","x_ite/Bits/X3DConstants"],function(e,t,n,o,i){"use strict";function r(e){o.call(this,e),this.addType(i.ComposedVolumeStyle)}return r.prototype=Object.assign(Object.create(o.prototype),{constructor:r,fieldDefinitions:new n([new t(i.inputOutput,"enabled",new e.SFBool(!0)),new t(i.inputOutput,"metadata",new e.SFNode),new t(i.inputOutput,"renderStyle",new e.MFNode)]),getTypeName:function(){return"ComposedVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"}}),r}),e("x_ite/Components/VolumeRendering/EdgeEnhancementVolumeStyle",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/VolumeRendering/X3DComposableVolumeRenderStyleNode","x_ite/Bits/X3DConstants"],function(e,t,n,o,i){"use strict";function r(e){o.call(this,e),this.addType(i.EdgeEnhancementVolumeStyle)}return r.prototype=Object.assign(Object.create(o.prototype),{constructor:r,fieldDefinitions:new n([new t(i.inputOutput,"edgeColor",new e.SFColorRGBA(0,0,0,1)),new t(i.inputOutput,"enabled",new e.SFBool(!0)),new t(i.inputOutput,"gradientThreshold",new e.SFFloat(.4)),new t(i.inputOutput,"metadata",new e.SFNode),new t(i.inputOutput,"surfaceNormals",new e.SFNode)]),getTypeName:function(){return"EdgeEnhancementVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"}}),r}),e("x_ite/Components/VolumeRendering/X3DVolumeDataNode",["x_ite/Fields","x_ite/Components/Core/X3DChildNode","x_ite/Components/Grouping/X3DBoundedObject","x_ite/Bits/X3DConstants","x_ite/Browser/Core/TextureQuality","standard/Math/Numbers/Vector3"],function(e,t,n,o,i,r){"use strict";function s(e){t.call(this,e),n.call(this,e),this.addType(o.X3DVolumeDataNode),this.proximitySensorNode=e.createNode("ProximitySensor",!1),this.transformNode=e.createNode("Transform",!1),this.shapeNode=e.createNode("Shape",!1),this.appearanceNode=e.createNode("Appearance",!1),this.textureTransformNode=e.createNode("TextureTransform3D",!1),this.geometryNode=e.createNode("QuadSet",!1),this.textureCoordinateNode=e.createNode("TextureCoordinate3D",!1),this.coordinateNode=e.createNode("Coordinate",!1),this.setCameraObject(!0)}return s.prototype=Object.assign(Object.create(t.prototype),n.prototype,{constructor:s,initialize:function(){t.prototype.initialize.call(this),n.prototype.initialize.call(this)},initialize:function(){t.prototype.initialize.call(this),n.prototype.initialize.call(this);var o=this.getBrowser(),i=o.getContext();o.getBrowserOptions().TextureQuality_.addInterest("set_dimensions__",this),i.getVersion()>=2&&(this.dimensions_.addInterest("set_dimensions__",this),this.set_dimensions__()),this.appearanceNode.setPrivate(!0),this.proximitySensorNode.orientation_changed_.addFieldInterest(this.transformNode.rotation_),this.proximitySensorNode.orientation_changed_.addFieldInterest(this.textureTransformNode.rotation_),this.proximitySensorNode.size_=new e.SFVec3f(-1,-1,-1),this.transformNode.children_=new e.MFNode(this.shapeNode),this.shapeNode.appearance_=this.appearanceNode,this.shapeNode.geometry_=this.geometryNode,this.appearanceNode.textureTransform_=this.textureTransformNode,this.textureTransformNode.translation_=new e.SFVec3f(.5,.5,.5),this.textureTransformNode.center_=new e.SFVec3f(-.5,-.5,-.5),this.geometryNode.texCoord_=this.textureCoordinateNode,this.geometryNode.coord_=this.coordinateNode,this.coordinateNode.setup(),this.textureCoordinateNode.setup(),this.geometryNode.setup(),this.textureTransformNode.setup(),this.appearanceNode.setup(),this.shapeNode.setup(),this.transformNode.setup(),this.proximitySensorNode.setup()},getBBox:function(e){return this.bboxSize_.getValue().equals(this.getDefaultBBoxSize())?e.set(this.dimensions_.getValue(),r.Zero):e.set(this.bboxSize_.getValue(),this.bboxCenter_.getValue())},getAppearance:function(){return this.appearanceNode},getNumPlanes:function(){switch(this.getBrowser().getBrowserOptions().getTextureQuality()){case i.LOW:return 200;case i.MEDIUM:return 400;case i.HIGH:return 600}return 200},set_dimensions__:function(){var t=this.getNumPlanes(),n=this.dimensions_.getValue().abs(),o=n/2,i=[];this.coordinateNode.point_.length=0;for(var r=0;r<t;++r){var s=r/(t-1)-.5;i.push(o,o,n*s,-o,o,n*s,-o,-o,n*s,o,-o,n*s)}this.coordinateNode.point_=i,this.textureCoordinateNode.point_=i,this.textureTransformNode.scale_=new e.SFVec3f(1/this.dimensions_.x,1/this.dimensions_.y,1/this.dimensions_.z)},traverse:function(e,t){this.proximitySensorNode.traverse(e,t),this.transformNode.traverse(e,t)}}),s}),e("x_ite/Components/VolumeRendering/IsoSurfaceVolumeData",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/VolumeRendering/X3DVolumeDataNode","x_ite/Bits/X3DConstants"],function(e,t,n,o,i){"use strict";function r(e){o.call(this,e),this.addType(i.IsoSurfaceVolumeData)}return r.prototype=Object.assign(Object.create(o.prototype),{constructor:r,fieldDefinitions:new n([new t(i.inputOutput,"contourStepSize",new e.SFFloat(0)),new t(i.inputOutput,"dimensions",new e.SFVec3f(1,1,1)),new t(i.inputOutput,"gradients",new e.SFNode),new t(i.inputOutput,"metadata",new e.SFNode),new t(i.inputOutput,"renderStyle",new e.MFNode),new t(i.inputOutput,"surfaceTolerance",new e.SFFloat(0)),new t(i.inputOutput,"surfaceValues",new e.MFFloat),new t(i.inputOutput,"voxels",new e.SFNode),new t(i.initializeOnly,"bboxCenter",new e.SFVec3f(0,0,0)),new t(i.initializeOnly,"bboxSize",new e.SFVec3f(-1,-1,-1))]),getTypeName:function(){return"IsoSurfaceVolumeData"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"children"}}),r}),e("x_ite/Components/VolumeRendering/ProjectionVolumeStyle",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/VolumeRendering/X3DVolumeRenderStyleNode","x_ite/Bits/X3DConstants"],function(e,t,n,o,i){"use strict";function r(e){o.call(this,e),this.addType(i.ProjectionVolumeStyle)}return r.prototype=Object.assign(Object.create(o.prototype),{constructor:r,fieldDefinitions:new n([new t(i.inputOutput,"enabled",new e.SFBool(!0)),new t(i.inputOutput,"metadata",new e.SFNode),new t(i.inputOutput,"intensityThreshold",new e.SFFloat(0))]),getTypeName:function(){return"ProjectionVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"}}),r}),e("x_ite/Components/VolumeRendering/SegmentedVolumeData",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/VolumeRendering/X3DVolumeDataNode","x_ite/Bits/X3DConstants"],function(e,t,n,o,i){"use strict";function r(e){o.call(this,e),this.addType(i.SegmentedVolumeData)}return r.prototype=Object.assign(Object.create(o.prototype),{constructor:r,fieldDefinitions:new n([new t(i.inputOutput,"dimensions",new e.SFVec3f(1,1,1)),new t(i.inputOutput,"metadata",new e.SFNode),new t(i.inputOutput,"renderStyle",new e.MFNode),new t(i.inputOutput,"segmentEnabled",new e.MFBool),new t(i.inputOutput,"segmentIdentifiers",new e.SFNode),new t(i.inputOutput,"voxels",new e.SFNode),new t(i.initializeOnly,"bboxCenter",new e.SFVec3f(0,0,0)),new t(i.initializeOnly,"bboxSize",new e.SFVec3f(-1,-1,-1))]),getTypeName:function(){return"SegmentedVolumeData"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"children"}}),r}),e("x_ite/Components/VolumeRendering/ShadedVolumeStyle",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/VolumeRendering/X3DComposableVolumeRenderStyleNode","x_ite/Bits/X3DConstants"],function(e,t,n,o,i){"use strict";function r(e){o.call(this,e),this.addType(i.ShadedVolumeStyle)}return r.prototype=Object.assign(Object.create(o.prototype),{constructor:r,fieldDefinitions:new n([new t(i.inputOutput,"enabled",new e.SFBool(!0)),new t(i.inputOutput,"lighting",new e.SFBool),new t(i.inputOutput,"material",new e.SFNode),new t(i.inputOutput,"metadata",new e.SFNode),new t(i.inputOutput,"shadows",new e.SFBool),new t(i.inputOutput,"surfaceNormals",new e.SFNode),new t(i.initializeOnly,"phaseFunction",new e.SFString("Henyey-Greenstein"))]),getTypeName:function(){return"ShadedVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"}}),r}),e("x_ite/Components/VolumeRendering/SilhouetteEnhancementVolumeStyle",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/VolumeRendering/X3DComposableVolumeRenderStyleNode","x_ite/Bits/X3DConstants"],function(e,t,n,o,i){"use strict";function r(e){o.call(this,e),this.addType(i.SilhouetteEnhancementVolumeStyle)}return r.prototype=Object.assign(Object.create(o.prototype),{constructor:r,fieldDefinitions:new n([new t(i.inputOutput,"enabled",new e.SFBool(!0)),new t(i.inputOutput,"metadata",new e.SFNode),new t(i.inputOutput,"silhouetteBoundaryOpacity",new e.SFFloat(0)),new t(i.inputOutput,"silhouetteRetainedOpacity",new e.SFFloat(1)),new t(i.inputOutput,"silhouetteSharpness",new e.SFFloat(.5)),new t(i.inputOutput,"surfaceNormals",new e.SFNode)]),getTypeName:function(){return"SilhouetteEnhancementVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"}}),r}),e("x_ite/Components/VolumeRendering/ToneMappedVolumeStyle",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/VolumeRendering/X3DComposableVolumeRenderStyleNode","x_ite/Bits/X3DConstants","x_ite/Bits/X3DCast"],function(e,t,n,o,i,r){"use strict";function s(e){o.call(this,e),this.addType(i.ToneMappedVolumeStyle)}return s.prototype=Object.assign(Object.create(o.prototype),{constructor:s,fieldDefinitions:new n([new t(i.inputOutput,"metadata",new e.SFNode),new t(i.inputOutput,"enabled",new e.SFBool(!0)),new t(i.inputOutput,"coolColor",new e.SFColorRGBA(0,0,1,0)),new t(i.inputOutput,"warmColor",new e.SFColorRGBA(1,1,0,0)),new t(i.inputOutput,"surfaceNormals",new e.SFNode)]),getTypeName:function(){return"ToneMappedVolumeStyle"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"renderStyle"},initialize:function(){o.prototype.initialize.call(this),this.getBrowser().getContext().getVersion()<2||(this.surfaceNormals_.addInterest("set_surfaceNormals__",this),this.set_surfaceNormals__())},set_surfaceNormals__:function(){this.surfaceNormalsNode=r(i.X3DTexture3DNode,this.surfaceNormals_)},addShaderFields:function(t){t.addUserDefinedField(i.inputOutput,"coolColor_"+this.getId(),this.coolColor_.copy()),t.addUserDefinedField(i.inputOutput,"warmColor_"+this.getId(),this.warmColor_.copy()),this.surfaceNormalsNode&&t.addUserDefinedField(i.inputOutput,"surfaceNormals_"+this.getId(),new e.SFNode(this.surfaceNormalsNode))},getUniformsText:function(){var e="";return e+="\n",e+="// ToneMappedVolumeStyle\n",e+="\n",e+="uniform vec4 coolColor_"+this.getId()+";\n",e+="uniform vec4 warmColor_"+this.getId()+";\n",this.surfaceNormalsNode?(e+="uniform sampler3D surfaceNormals_"+this.getId()+";\n",e+="\n",e+="vec4\n",e+="getNormal_"+this.getId()+" (in vec3 texCoord)\n",e+="{\n",e+="\tvec4 n = texture (surfaceNormals_"+this.getId()+", texCoord) * 2.0 - 1.0\n",e+="\treturn vec4 (normalize (n .xyz), length (n .xyz));\n",e+="}\n"):(e+="\n",e+="vec4\n",e+="getNormal_"+this.getId()+" (in vec3 texCoord)\n",e+="{\n",e+="\tvec4 offset = vec4 (1.0 / x3d_TextureSize .x, 1.0 / x3d_TextureSize .y, 1.0 / x3d_TextureSize .z, 0.0);\n",e+="\tfloat v0 = texture (x3d_Texture3D [0], texCoord + offset .xww) .r;\n",e+="\tfloat v1 = texture (x3d_Texture3D [0], texCoord - offset .xww) .r;\n",e+="\tfloat v2 = texture (x3d_Texture3D [0], texCoord + offset .wyw) .r;\n",e+="\tfloat v3 = texture (x3d_Texture3D [0], texCoord - offset .wyw) .r;\n",e+="\tfloat v4 = texture (x3d_Texture3D [0], texCoord + offset .wwz) .r;\n",e+="\tfloat v5 = texture (x3d_Texture3D [0], texCoord - offset .wwz) .r;\n",e+="\tvec3 n = vec3 (v0 - v1, v2 - v3, v4 - v5) * 0.5;\n",e+="\treturn vec4 (normalize (n), length (n));\n",e+="}\n"),e+="\n",e+="vec4\n",e+="toneMapped_"+this.getId()+" (in vec4 surfaceNormal, in vec3 lightDir, in vec4 coolColor, in vec4 warmColor)\n",e+="{\n",e+="\tfloat colorFactor = (1.0 + dot (lightDir, surfaceNormal .xyz)) * 0.5;\n",e+="\treturn mix (warmColor, coolColor, colorFactor);\n",e+="}\n"},getFunctionsText:function(){var e="";return e+="\n",e+="\t// ToneMappedVolumeStyle\n",e+="\n",e+="\t{\n",e+="\t\tvec4 surfaceNormal = getNormal_"+this.getId()+" (texCoord);\n",e+="\t\tvec4 toneColor = vec4 (0.0);\n",e+="\n",e+="\t\tfor (int i = 0; i < x3d_MaxLights; ++ i)\n",e+="\t\t{\n",e+="\t\t\tif (i == x3d_NumLights)\n",e+="\t\t\t\tbreak;\n",e+="\n",e+="\t\t\tx3d_LightSourceParameters light = x3d_LightSource [i];\n",e+="\n",e+="\t\t\tvec3 L = light .type == x3d_DirectionalLight ? -light .direction : light .location - vertex;\n",e+="\t\t\ttoneColor += toneMapped_"+this.getId()+" (surfaceNormal, L, coolColor_"+this.getId()+", warmColor_"+this.getId()+");\n",e+="\t\t}\n",e+="\n",e+="\t\ttextureColor .rgb = toneColor .rgb;\n",e+="\t\ttextureColor .a  *= toneColor .a;\n",e+="\t}\n"}}),s}),e("text/text!x_ite/Browser/VolumeRendering/VolumeStyle.vs",[],function(){return"#version 300 es\n\nprecision mediump float;\nprecision mediump int;\n\nuniform mat4 x3d_ProjectionMatrix;\nuniform mat4 x3d_ModelViewMatrix;\nuniform mat4 x3d_TextureMatrix [1];\n\nin vec4 x3d_Vertex;\nin vec4 x3d_TexCoord0;\n\nout vec3 vertex;\nout vec4 texCoord;\n\nvoid\nmain ()\n{\n\tvec4 position = x3d_ModelViewMatrix * x3d_Vertex;\n\n\tvertex   = position .xyz;\n\ttexCoord = x3d_TextureMatrix [0] * x3d_TexCoord0;\n\n\tgl_Position = x3d_ProjectionMatrix * position;\n}\n"}),e("text/text!x_ite/Browser/VolumeRendering/VolumeStyle.fs",[],function(){return'#version 300 es\n\nprecision mediump float;\nprecision mediump int;\nprecision mediump sampler3D;\n\nuniform int x3d_NumLights;\nuniform x3d_LightSourceParameters x3d_LightSource [x3d_MaxLights];\n\nuniform int       x3d_NumTextures;\nuniform sampler3D x3d_Texture3D [1];\nuniform vec3      x3d_TextureSize;\n\n// VOLUME_STYLES_UNIFORMS\n\nin vec3 vertex;\nin vec4 texCoord;\n\nout vec4 x3d_FragColor;\n\n#pragma X3D include "../webgl2/include/ClipPlanes.glsl"\n\nvec4\ngetTextureColor (in vec3 texCoord)\n{\n\tif (x3d_NumTextures == 0)\n\t\tdiscard;\n\n\tif (texCoord .s < 0.0 || texCoord .s > 1.0)\n\t\tdiscard;\n\n\tif (texCoord .t < 0.0 || texCoord .t > 1.0)\n\t\tdiscard;\n\n\tif (texCoord .p < 0.0 || texCoord .p > 1.0)\n\t\tdiscard;\n\n\tvec4 textureColor = texture (x3d_Texture3D [0], texCoord);\n\n\t// Apply volume styles.\n\n// VOLUME_STYLES_FUNCTIONS\n\n\treturn textureColor;\n}\n\nvoid\nmain ()\n{\n\tclip ();\n\n\tx3d_FragColor = getTextureColor (texCoord .stp / texCoord .q);\n}\n'}),e("x_ite/Components/VolumeRendering/VolumeData",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/VolumeRendering/X3DVolumeDataNode","x_ite/Components/Shaders/ComposedShader","x_ite/Components/Shaders/ShaderPart","x_ite/Bits/X3DConstants","x_ite/Bits/X3DCast","text!x_ite/Browser/VolumeRendering/VolumeStyle.vs","text!x_ite/Browser/VolumeRendering/VolumeStyle.fs"],function(e,t,n,o,i,r,s,u,d,a){"use strict";function l(e){o.call(this,e),this.addType(s.VolumeData),this.renderStyleNode=null,this.blendModeNode=e.createNode("BlendMode",!1)}return l.prototype=Object.assign(Object.create(o.prototype),{constructor:l,fieldDefinitions:new n([new t(s.inputOutput,"metadata",new e.SFNode),new t(s.inputOutput,"dimensions",new e.SFVec3f(1,1,1)),new t(s.inputOutput,"renderStyle",new e.SFNode),new t(s.inputOutput,"voxels",new e.SFNode),new t(s.initializeOnly,"bboxCenter",new e.SFVec3f(0,0,0)),new t(s.initializeOnly,"bboxSize",new e.SFVec3f(-1,-1,-1))]),getTypeName:function(){return"VolumeData"},getComponentName:function(){return"VolumeRendering"},getContainerField:function(){return"children"},initialize:function(){o.prototype.initialize.call(this),this.getBrowser().getContext().getVersion()<2||(this.renderStyle_.addInterest("set_renderStyle__",this),this.voxels_.addFieldInterest(this.getAppearance().texture_),this.blendModeNode.setup(),this.getAppearance().texture_=this.voxels_,this.getAppearance().blendMode_=this.blendModeNode,this.set_renderStyle__(),this.set_voxels__())},set_renderStyle__:function(){this.renderStyleNode&&this.renderStyleNode.removeInterest("set_createShader__",this),this.renderStyleNode=u(s.X3DVolumeRenderStyleNode,this.renderStyle_),this.renderStyleNode||(this.renderStyleNode=this.getBrowser().getDefaultVolumeStyle()),this.renderStyleNode&&this.renderStyleNode.addInterest("set_createShader__",this),this.set_createShader__()},set_voxels__:function(){this.voxelsNode&&this.voxelsNode.removeInterest("set_textureSize__",this),this.voxelsNode=u(s.X3DTexture3DNode,this.voxels_),this.voxelsNode&&(this.voxelsNode.addInterest("set_textureSize__",this),this.set_textureSize__())},set_textureSize__:function(){var e=this.textureSize;e&&(e.x=this.voxelsNode.getWidth(),e.y=this.voxelsNode.getHeight(),e.z=this.voxelsNode.getDepth())},set_createShader__:function(){this.getAppearance().shaders_[0]=this.createShader()},createShader:function(){console.log("Creating VolumeData Shader ..."),a=a.replace(/\/\/ VOLUME_STYLES_UNIFORMS\n/,this.renderStyleNode.getUniformsText()),a=a.replace(/\/\/ VOLUME_STYLES_FUNCTIONS\n/,this.renderStyleNode.getFunctionsText()),this.getBrowser().print(a);var t=new r(this.getExecutionContext());t.setName("VolumeDataVertexShader"),t.url_.push("data:x-shader/x-vertex,"+d),t.setup();var n=new r(this.getExecutionContext());n.setName("VolumeDataFragmentShader"),n.type_="FRAGMENT",n.url_.push("data:x-shader/x-fragment,"+a),n.setup();var o=new i(this.getExecutionContext());return o.setName("VolumeDataShader"),o.language_="GLSL",o.parts_.push(t),o.parts_.push(n),this.voxelsNode?(this.textureSize=new e.SFVec3f(this.voxelsNode.getWidth(),this.voxelsNode.getHeight(),this.voxelsNode.getDepth()),o.addUserDefinedField(s.inputOutput,"x3d_TextureSize",this.textureSize)):this.textureSize=null,this.renderStyleNode.addShaderFields(o),o.setup(),o}}),l}),e(["x_ite/Components","x_ite/Browser/VolumeRendering/X3DVolumeRenderingContext","x_ite/Components/VolumeRendering/BlendedVolumeStyle","x_ite/Components/VolumeRendering/BoundaryEnhancementVolumeStyle","x_ite/Components/VolumeRendering/CartoonVolumeStyle","x_ite/Components/VolumeRendering/ComposedVolumeStyle","x_ite/Components/VolumeRendering/EdgeEnhancementVolumeStyle","x_ite/Components/VolumeRendering/IsoSurfaceVolumeData","x_ite/Components/VolumeRendering/OpacityMapVolumeStyle","x_ite/Components/VolumeRendering/ProjectionVolumeStyle","x_ite/Components/VolumeRendering/SegmentedVolumeData","x_ite/Components/VolumeRendering/ShadedVolumeStyle","x_ite/Components/VolumeRendering/SilhouetteEnhancementVolumeStyle","x_ite/Components/VolumeRendering/ToneMappedVolumeStyle","x_ite/Components/VolumeRendering/VolumeData","x_ite/Components/VolumeRendering/X3DComposableVolumeRenderStyleNode","x_ite/Components/VolumeRendering/X3DVolumeDataNode","x_ite/Components/VolumeRendering/X3DVolumeRenderStyleNode",X3D.getComponentUrl("cad-geometry"),X3D.getComponentUrl("texturing-3d"),X3D.getComponentUrl("x_ite")],function(e,t,n,o,i,r,s,u,d,a,l,c,p,m,h,_,x,g){"use strict";e.addComponent({name:"VolumeRendering",types:{BlendedVolumeStyle:n,BoundaryEnhancementVolumeStyle:o,CartoonVolumeStyle:i,ComposedVolumeStyle:r,EdgeEnhancementVolumeStyle:s,IsoSurfaceVolumeData:u,OpacityMapVolumeStyle:d,ProjectionVolumeStyle:a,SegmentedVolumeData:l,ShadedVolumeStyle:c,SilhouetteEnhancementVolumeStyle:p,ToneMappedVolumeStyle:m,VolumeData:h},abstractTypes:{X3DComposableVolumeRenderStyleNode:_,X3DVolumeDataNode:x,X3DVolumeRenderStyleNode:g},browser:t})})}();
