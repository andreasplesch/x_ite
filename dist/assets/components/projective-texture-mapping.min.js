!function(){var t=X3D.define;X3D.require;t("x_ite/Components/ProjectiveTextureMapping/X3DTextureProjectorNode",["x_ite/Components/Core/X3DChildNode","x_ite/Bits/X3DConstants","x_ite/Bits/X3DCast","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Matrix4"],function(t,e,i,r,n,o){"use strict";function a(i){t.call(this,i),this.addType(e.X3DTextureProjectorNode),this.location_.setUnit("length"),this.farDistance_.setUnit("length"),this.location_.setUnit("length")}return a.prototype=Object.assign(Object.create(t.prototype),{constructor:a,initialize:function(){t.prototype.initialize.call(this),this.texture_.addInterest("set_texture__",this),this.set_texture__()},getGlobal:function(){return this.global_.getValue()},getLocation:function(){return this.location_.getValue()},getDirection:function(){return this.direction_.getValue()},getNearDistance:function(){return this.nearDistance_.getValue()},getFarDistance:function(){return this.farDistance_.getValue()},getTexture:function(){return this.textureNode},getBiasMatrix:function(){var t=new o(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1);return function(){return t}}(),straightenHorizon:function(){var t=new r(0,0,0),e=new r(0,0,0),i=new r(0,0,0),o=new n(0,0,1,0);return function(n){n.multVecRot(t.assign(r.xAxis).negate()),n.multVecRot(i.assign(r.zAxis));var a=i.cross(this.upVector_.getValue());return a.equals(r.Zero)?n:a.equals(t)?n:a.equals(e.assign(t).negate())?n:(o.setFromToVec(t,a),n.multRight(o))}}(),set_texture__:function(){this.textureNode&&this.textureNode.removeInterest("set_aspectRatio__",this),this.textureNode=i(e.X3DTexture2DNode,this.texture_),this.textureNode&&this.textureNode.addInterest("set_aspectRatio__",this),this.set_aspectRatio__()},set_aspectRatio__:function(){this.textureNode?this.aspectRatio_=this.textureNode.getWidth()/this.textureNode.getHeight():this.aspectRatio_=0},push:function(t){if(this.on_.getValue()&&this.textureNode)if(t.isIndependent()){var e=this.getTextureProjectors().pop();e.set(t.getBrowser(),this,t.getModelViewMatrix().get()),this.global_.getValue()?(t.getGlobalObjects().push(e),t.getTextureProjectors().push(e)):(t.getShaderObjects().push(e),t.getTextureProjectors().push(e))}else{var e=t.getTextureProjectorContainer();this.global_.getValue()?(e.getModelViewMatrix().pushMatrix(t.getModelViewMatrix().get()),t.getGlobalObjects().push(e),t.getTextureProjectors().push(e)):(e.getModelViewMatrix().pushMatrix(t.getModelViewMatrix().get()),t.getShaderObjects().push(e),t.getTextureProjectors().push(e))}},pop:function(t){if(this.on_.getValue()&&this.textureNode){if(this.global_.getValue())return;t.isIndependent()?t.getBrowser().getShaderObjects().push(t.getShaderObjects().pop()):t.getShaderObjects().pop()}}}),a}),t("x_ite/Components/ProjectiveTextureMapping/TextureProjectorPerspective",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/ProjectiveTextureMapping/X3DTextureProjectorNode","x_ite/Bits/X3DConstants","standard/Math/Geometry/Camera","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Matrix4","standard/Math/Utility/MatrixStack","standard/Utility/ObjectCache"],function(t,e,i,r,n,o,a,s,u,c,h){"use strict";function x(){this.projectionMatrix=new u,this.modelViewMatrix=new c(u),this.modelMatrix=new u,this.invTextureSpaceMatrix=new u,this.invTextureSpaceProjectionMatrix=new u,this.location=new a(0,0,0),this.locationArray=new Float32Array(3),this.direction=new a(0,0,0),this.rotation=new s,this.projectiveTextureMatrix=new u,this.projectiveTextureMatrixArray=new Float32Array(16)}function l(t){r.call(this,t),this.addType(n.TextureProjectorPerspective),this.fieldOfView_.setUnit("angle")}var p=h(x);return x.prototype={constructor:x,set:function(t,e,i){this.browser=t,this.textureProjectorNode=e,this.modelViewMatrix.pushMatrix(i)},getModelViewMatrix:function(){return this.modelViewMatrix},setGlobalVariables:function(t){try{var e=this.textureProjectorNode,i=t.getCameraSpaceMatrix().get(),r=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(i),n=this.invTextureSpaceMatrix.assign(e.getGlobal()?r:u.Identity);this.rotation.setFromToVec(a.zAxis,this.direction.assign(e.getDirection()).negate()),e.straightenHorizon(this.rotation),n.translate(e.getLocation()),n.rotate(this.rotation),n.inverse();var s=e.getTexture().getWidth(),c=e.getTexture().getHeight(),h=e.getNearDistance(),x=e.getFarDistance(),l=e.getFieldOfView();o.perspective(l,h,x,s,c,this.projectionMatrix),e.getGlobal()||n.multLeft(r.inverse()),this.invTextureSpaceProjectionMatrix.assign(n).multRight(this.projectionMatrix).multRight(e.getBiasMatrix()),this.projectiveTextureMatrix.assign(i).multRight(this.invTextureSpaceProjectionMatrix),this.projectiveTextureMatrixArray.set(this.projectiveTextureMatrix),this.modelViewMatrix.get().multVecMatrix(this.location.assign(e.location_.getValue())),this.locationArray.set(this.location)}catch(t){console.log(t)}},setShaderUniforms:function(t,e){var i=e.numProjectiveTextures++;if(!e.hasTextureProjector(i,this)){var r=this.textureProjectorNode,n=r.getTexture();t.activeTexture(t.TEXTURE0+this.browser.getProjectiveTextureUnits()[i]),t.bindTexture(t.TEXTURE_2D,n.getTexture()),t.activeTexture(t.TEXTURE0),t.uniformMatrix4fv(e.x3d_ProjectiveTextureMatrix[i],!1,this.projectiveTextureMatrixArray),t.uniform3fv(e.x3d_ProjectiveTextureLocation[i],this.locationArray)}},dispose:function(){p.push(this)}},l.prototype=Object.assign(Object.create(r.prototype),{constructor:l,fieldDefinitions:new i([new e(n.inputOutput,"metadata",new t.SFNode),new e(n.inputOutput,"description",new t.SFString),new e(n.inputOutput,"on",new t.SFBool(!0)),new e(n.inputOutput,"global",new t.SFBool(!0)),new e(n.inputOutput,"location",new t.SFVec3f(0,0,1)),new e(n.inputOutput,"direction",new t.SFVec3f(0,0,1)),new e(n.inputOutput,"upVector",new t.SFVec3f(0,0,1)),new e(n.inputOutput,"fieldOfView",new t.SFFloat(.7854)),new e(n.inputOutput,"nearDistance",new t.SFFloat(1)),new e(n.inputOutput,"farDistance",new t.SFFloat(10)),new e(n.outputOnly,"aspectRatio",new t.SFFloat),new e(n.inputOutput,"texture",new t.SFNode)]),getTypeName:function(){return"TextureProjectorPerspective"},getComponentName:function(){return"ProjectiveTextureMapping"},getContainerField:function(){return"children"},initialize:function(){r.prototype.initialize.call(this)},getFieldOfView:function(){var t=this.fieldOfView_.getValue();return t>0&&t<Math.PI?t:Math.PI/4},getTextureProjectors:function(){return p}}),l}),t("x_ite/Components/ProjectiveTextureMapping/TextureProjectorParallel",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/ProjectiveTextureMapping/X3DTextureProjectorNode","x_ite/Bits/X3DConstants","standard/Math/Geometry/Camera","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Matrix4","standard/Math/Utility/MatrixStack","standard/Utility/ObjectCache"],function(t,e,i,r,n,o,a,s,u,c,h){"use strict";function x(){this.projectionMatrix=new u,this.modelViewMatrix=new c(u),this.modelMatrix=new u,this.invTextureSpaceMatrix=new u,this.location=new a(0,0,0),this.locationArray=new Float32Array(3),this.invTextureSpaceProjectionMatrix=new u,this.direction=new a(0,0,0),this.rotation=new s,this.projectiveTextureMatrix=new u,this.projectiveTextureMatrixArray=new Float32Array(16)}function l(t){r.call(this,t),this.addType(n.TextureProjectorParallel),this.fieldOfView_.setUnit("length")}var p=h(x);return x.prototype={constructor:x,set:function(t,e,i){this.browser=t,this.textureProjectorNode=e,this.modelViewMatrix.pushMatrix(i)},getModelViewMatrix:function(){return this.modelViewMatrix},setGlobalVariables:function(t){try{var e=this.textureProjectorNode,i=t.getCameraSpaceMatrix().get(),r=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(i),n=this.invTextureSpaceMatrix.assign(e.getGlobal()?r:u.Identity);this.rotation.setFromToVec(a.zAxis,this.direction.assign(e.getDirection()).negate()),e.straightenHorizon(this.rotation),n.translate(e.getLocation()),n.rotate(this.rotation),n.inverse();var s=e.getTexture().getWidth(),c=e.getTexture().getHeight(),h=s/c,x=e.getMinimumX(),l=e.getMaximumX(),p=e.getMinimumY(),g=e.getMaximumY(),d=e.getSizeX(),m=e.getSizeY(),f=e.getNearDistance(),w=e.getFarDistance();if(h>d/m){var M=(x+l)/2,T=m*h/2;o.ortho(M-T,M+T,p,g,f,w,this.projectionMatrix)}else{var M=(p+g)/2,T=d/h/2;o.ortho(x,l,M-T,M+T,f,w,this.projectionMatrix)}e.getGlobal()||n.multLeft(r.inverse()),this.invTextureSpaceProjectionMatrix.assign(n).multRight(this.projectionMatrix).multRight(e.getBiasMatrix()),this.projectiveTextureMatrix.assign(i).multRight(this.invTextureSpaceProjectionMatrix),this.projectiveTextureMatrixArray.set(this.projectiveTextureMatrix),this.modelViewMatrix.get().multVecMatrix(this.location.assign(e.location_.getValue())),this.locationArray.set(this.location)}catch(t){console.log(t)}},setShaderUniforms:function(t,e){var i=e.numProjectiveTextures++;if(!e.hasTextureProjector(i,this)){var r=this.textureProjectorNode,n=r.getTexture();t.activeTexture(t.TEXTURE0+this.browser.getProjectiveTextureUnits()[i]),t.bindTexture(t.TEXTURE_2D,n.getTexture()),t.activeTexture(t.TEXTURE0),t.uniformMatrix4fv(e.x3d_ProjectiveTextureMatrix[i],!1,this.projectiveTextureMatrixArray),t.uniform3fv(e.x3d_ProjectiveTextureLocation[i],this.locationArray)}},dispose:function(){p.push(this)}},l.prototype=Object.assign(Object.create(r.prototype),{constructor:l,fieldDefinitions:new i([new e(n.inputOutput,"metadata",new t.SFNode),new e(n.inputOutput,"description",new t.SFString),new e(n.inputOutput,"on",new t.SFBool(!0)),new e(n.inputOutput,"global",new t.SFBool(!0)),new e(n.inputOutput,"location",new t.SFVec3f(0,0,1)),new e(n.inputOutput,"direction",new t.SFVec3f(0,0,1)),new e(n.inputOutput,"upVector",new t.SFVec3f(0,0,1)),new e(n.inputOutput,"fieldOfView",new t.MFFloat(-1,-1,1,1)),new e(n.inputOutput,"nearDistance",new t.SFFloat(1)),new e(n.inputOutput,"farDistance",new t.SFFloat(10)),new e(n.outputOnly,"aspectRatio",new t.SFFloat),new e(n.inputOutput,"texture",new t.SFNode)]),getTypeName:function(){return"TextureProjectorParallel"},getComponentName:function(){return"ProjectiveTextureMapping"},getContainerField:function(){return"children"},initialize:function(){r.prototype.initialize.call(this),this.fieldOfView_.addInterest("set_fieldOfView___",this),this.set_fieldOfView___()},getMinimumX:function(){return this.minimumX},getMinimumY:function(){return this.minimumY},getMaximumX:function(){return this.maximumX},getMaximumY:function(){return this.maximumY},getSizeX:function(){return this.sizeX},getSizeY:function(){return this.sizeY},getTextureProjectors:function(){return p},set_fieldOfView___:function(){var t=this.fieldOfView_.length;this.minimumX=t>0?this.fieldOfView_[0]:-1,this.minimumY=t>1?this.fieldOfView_[1]:-1,this.maximumX=t>2?this.fieldOfView_[2]:1,this.maximumY=t>3?this.fieldOfView_[3]:1,this.sizeX=this.maximumX-this.minimumX,this.sizeY=this.maximumY-this.minimumY}}),l}),t(["x_ite/Components","x_ite/Components/ProjectiveTextureMapping/TextureProjectorPerspective","x_ite/Components/ProjectiveTextureMapping/TextureProjectorParallel","x_ite/Components/ProjectiveTextureMapping/X3DTextureProjectorNode"],function(t,e,i,r){"use strict";t.addComponent({name:"ProjectiveTextureMapping",types:{TextureProjectorPerspective:e,TextureProjectorParallel:i},abstractTypes:{X3DTextureProjectorNode:r}})})}();
