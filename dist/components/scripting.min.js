!function(){var define=X3D.define,require=X3D.require;define("x_ite/Browser/Scripting/evaluate",[],function(){return function(){with(arguments[0])return eval(arguments[1])}}),define("x_ite/Components/Scripting/X3DScriptNode",["x_ite/Components/Core/X3DChildNode","x_ite/Components/Networking/X3DUrlObject","x_ite/Bits/X3DConstants"],function(e,t,i){"use strict";function n(n){e.call(this,n),t.call(this,n),this.addType(i.X3DScriptNode)}return n.prototype=Object.assign(Object.create(e.prototype),t.prototype,{constructor:n}),n}),define("x_ite/Components/Scripting/Script",["jquery","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Basic/X3DField","x_ite/Basic/X3DArrayField","x_ite/Fields","x_ite/Browser/X3DBrowser","x_ite/Configuration/ComponentInfo","x_ite/Configuration/ComponentInfoArray","x_ite/Configuration/ProfileInfo","x_ite/Configuration/ProfileInfoArray","x_ite/Configuration/UnitInfo","x_ite/Configuration/UnitInfoArray","x_ite/Execution/X3DExecutionContext","x_ite/Execution/X3DScene","x_ite/Prototype/ExternProtoDeclarationArray","x_ite/Prototype/ProtoDeclarationArray","x_ite/Prototype/X3DExternProtoDeclaration","x_ite/Prototype/X3DProtoDeclaration","x_ite/Routing/RouteArray","x_ite/Routing/X3DRoute","x_ite/Browser/Scripting/evaluate","x_ite/Components/Scripting/X3DScriptNode","x_ite/InputOutput/FileLoader","x_ite/Bits/X3DConstants","x_ite/Fields/SFNodeCache"],function(e,t,i,n,r,o,a,s,u,c,l,p,d,v,f,h,_,F,S,g,x,M,y,D,E,m){function C(e){y.call(this,e),this.addChildObjects("buffer",new o.SFTime),this.addType(E.Script)}return C.prototype=Object.assign(Object.create(y.prototype),{constructor:C,fieldDefinitions:new i([new t(E.inputOutput,"metadata",new o.SFNode),new t(E.inputOutput,"url",new o.MFString),new t(E.initializeOnly,"directOutput",new o.SFBool),new t(E.initializeOnly,"mustEvaluate",new o.SFBool)]),getTypeName:function(){return"Script"},getComponentName:function(){return"Scripting"},getContainerField:function(){return"children"},initialize:function(){y.prototype.initialize.call(this),this.url_.addInterest("set_url__",this),this.buffer_.addInterest("set_buffer__",this);var e=this.getUserDefinedFields();for(var t of e.values())t.setSet(!1);this.set_url__()},set_url__:function(){this.setLoadState(E.NOT_STARTED_STATE),this.requestAsyncLoad()},getExtendedEventHandling:function(){return!1},hasUserDefinedFields:function(){return!0},getSourceText:function(){return this.url_},requestAsyncLoad:function(){this.checkLoadState()!==E.COMPLETE_STATE&&this.checkLoadState()!==E.IN_PROGRESS_STATE&&0!==this.url_.length&&(this.setLoadState(E.IN_PROGRESS_STATE),this.buffer_.addEvent())},set_buffer__:function(){new D(this).loadScript(this.url_,function(e){null===e?this.setLoadState(E.FAILED_STATE):(this.setLoadState(E.COMPLETE_STATE),this.initialize__(e))}.bind(this))},getContext:function(e){try{var t=["initialize","prepareEvents","eventsProcessed","shutdown"],i=this.getUserDefinedFields();for(var n of i.values())switch(n.getAccessType()){case E.inputOnly:t.push(n.getName());break;case E.inputOutput:t.push("set_"+n.getName())}e+="\n;var "+t.join(",")+";",e+="\n["+t.join(",")+"];";for(var r=this.getGlobal(),o=M(r,e),a={},s=0;s<t.length;++s)"function"==typeof o[s]?a[t[s]]=o[s]:a[t[s]]=null;return a}catch(e){return this.setError("while evaluating script source",e),{}}},getGlobal:function(){function e(e){var t=M.createX3DFromString(String(e));if(t.getRootNodes().length&&t.getRootNodes()[0]){var i=o.SFNode.call(this,t.getRootNodes()[0].getValue());return m.set(i.getValue(),i),i}throw new Error("SFNode.new: invalid argument, must be 'string' is 'undefined'.")}var M=this.getBrowser();e.prototype=Object.create(o.SFNode.prototype),e.prototype.constructor=e;var y={NULL:{value:null},FALSE:{value:!1},TRUE:{value:!0},print:{value:function(){M.println.apply(M,arguments)}},trace:{value:function(){M.println.apply(M,arguments)}},Browser:{value:M},X3DConstants:{value:E},X3DBrowser:{value:a},X3DExecutionContext:{value:v},X3DScene:{value:f},ComponentInfo:{value:s},ComponentInfoArray:{value:u},ProfileInfo:{value:c},ProfileInfoArray:{value:l},UnitInfo:{value:p},UnitInfoArray:{value:d},ExternProtoDeclarationArray:{value:h},ProtoDeclarationArray:{value:_},X3DExternProtoDeclaration:{value:F},X3DProtoDeclaration:{value:S},RouteArray:{value:g},X3DRoute:{value:x},X3DFieldDefinition:{value:t},FieldDefinitionArray:{value:i},X3DField:{value:n},X3DArrayField:{value:r},SFColor:{value:o.SFColor},SFColorRGBA:{value:o.SFColorRGBA},SFImage:{value:o.SFImage},SFMatrix3d:{value:o.SFMatrix3d},SFMatrix3f:{value:o.SFMatrix3f},SFMatrix4d:{value:o.SFMatrix4d},SFMatrix4f:{value:o.SFMatrix4f},SFNode:{value:e},SFRotation:{value:o.SFRotation},SFVec2d:{value:o.SFVec2d},SFVec2f:{value:o.SFVec2f},SFVec3d:{value:o.SFVec3d},SFVec3f:{value:o.SFVec3f},SFVec4d:{value:o.SFVec4d},SFVec4f:{value:o.SFVec4f},VrmlMatrix:{value:o.VrmlMatrix},MFBool:{value:o.MFBool},MFColor:{value:o.MFColor},MFColorRGBA:{value:o.MFColorRGBA},MFDouble:{value:o.MFDouble},MFFloat:{value:o.MFFloat},MFImage:{value:o.MFImage},MFInt32:{value:o.MFInt32},MFMatrix3d:{value:o.MFMatrix3d},MFMatrix3f:{value:o.MFMatrix3f},MFMatrix4d:{value:o.MFMatrix4d},MFMatrix4f:{value:o.MFMatrix4f},MFNode:{value:o.MFNode},MFRotation:{value:o.MFRotation},MFString:{value:o.MFString},MFTime:{value:o.MFTime},MFVec2d:{value:o.MFVec2d},MFVec2f:{value:o.MFVec2f},MFVec3d:{value:o.MFVec3d},MFVec3f:{value:o.MFVec3f},MFVec4d:{value:o.MFVec4d},MFVec4f:{value:o.MFVec4f}},D=this.getUserDefinedFields();for(var C of D.values()){var w=C.getName();C.getAccessType()!==E.inputOnly&&(w in y||(y[w]={get:C.valueOf.bind(C),set:C.setValue.bind(C)}),C.getAccessType()===E.inputOutput&&(y[w+"_changed"]={get:C.valueOf.bind(C),set:C.setValue.bind(C)}))}return Object.create(Object.prototype,y)},set_live__:function(){var t=this.getUserDefinedFields();if(this.isLive().getValue()){e.isFunction(this.context.prepareEvents)&&this.getBrowser().prepareEvents().addInterest("prepareEvents__",this),e.isFunction(this.context.eventsProcessed)&&this.addInterest("eventsProcessed__",this);for(var i of t.values())switch(i.getAccessType()){case E.inputOnly:var n=this.context[i.getName()];e.isFunction(n)&&i.addInterest("set_field__",this,n);break;case E.inputOutput:var n=this.context["set_"+i.getName()];e.isFunction(n)&&i.addInterest("set_field__",this,n)}}else{this.context.prepareEvents&&this.getBrowser().prepareEvents().removeInterest("prepareEvents__",this),this.context.eventsProcessed&&this.removeInterest("eventsProcessed__",this);for(var i of t.values())switch(i.getAccessType()){case E.inputOnly:case E.inputOutput:i.removeInterest("set_field__",this)}}},initialize__:function(t){if(this.context=this.getContext(t),this.isLive().addInterest("set_live__",this),this.set_live__(),this.context.initialize){var i=this.getBrowser();i.getScriptStack().push(this);try{this.context.initialize()}catch(e){this.setError("in function 'initialize'",e)}i.getScriptStack().pop()}var n=this.getUserDefinedFields();for(var r of n.values())if(r.getSet()){var o=this.context[r.getName()];e.isFunction(o)&&this.set_field__(r,o)}},prepareEvents__:function(){var e=this.getBrowser();e.getScriptStack().push(this);try{this.context.prepareEvents(e.getCurrentTime()),e.addBrowserEvent()}catch(e){this.setError("in function 'prepareEvents'",e)}e.getScriptStack().pop()},set_field__:function(e,t){var i=this.getBrowser();e.setTainted(!0),i.getScriptStack().push(this);try{t(e.valueOf(),i.getCurrentTime())}catch(t){this.setError("in function '"+e.getName()+"'",t)}i.getScriptStack().pop(),e.setTainted(!1)},eventsProcessed__:function(){var e=this.getBrowser();e.getScriptStack().push(this);try{this.context.eventsProcessed()}catch(e){this.setError("in function 'eventsProcessed'",e)}e.getScriptStack().pop()},shutdown__:function(){var e=this.getBrowser();e.getScriptStack().push(this);try{this.context.shutdown()}catch(e){this.setError("in function 'shutdown'",e)}e.getScriptStack().pop()},setError:function(e,t){console.error("JavaScript Error in Script '"+this.getName()+"', "+e+"\nworld url is '"+this.getExecutionContext().getURL()+"':"),console.error(t)}}),C}),define(["x_ite/Components","x_ite/Components/Scripting/Script","x_ite/Components/Scripting/X3DScriptNode"],function(e,t,i){"use strict";e.addComponent({name:"Scripting",types:{Script:t},abstractTypes:{X3DScriptNode:i}})})}();
