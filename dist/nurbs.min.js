!function(){var t=X3D.define,e=X3D.require;t("x_ite/Components/NURBS/Contour2D",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Core/X3DNode","x_ite/Bits/X3DConstants"],function(t,e,i,n,r){"use strict";function s(t){n.call(this,t),this.addType(r.Contour2D)}return s.prototype=Object.assign(Object.create(n.prototype),{constructor:s,fieldDefinitions:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.inputOnly,"addChildren",new t.MFNode),new e(r.inputOnly,"removeChildren",new t.MFNode),new e(r.inputOutput,"children",new t.MFNode)]),getTypeName:function(){return"Contour2D"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"trimmingContour"}}),s}),t("x_ite/Components/NURBS/X3DNurbsControlCurveNode",["x_ite/Components/Core/X3DNode","x_ite/Bits/X3DConstants"],function(t,e){"use strict";function i(i){t.call(this,i),this.addType(e.X3DNurbsControlCurveNode)}return i.prototype=Object.assign(Object.create(t.prototype),{constructor:i}),i}),t("x_ite/Components/NURBS/ContourPolyline2D",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/NURBS/X3DNurbsControlCurveNode","x_ite/Bits/X3DConstants"],function(t,e,i,n,r){"use strict";function s(t){n.call(this,t),this.addType(r.ContourPolyline2D)}return s.prototype=Object.assign(Object.create(n.prototype),{constructor:s,fieldDefinitions:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.inputOutput,"controlPoint",new t.MFVec2d)]),getTypeName:function(){return"ContourPolyline2D"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"children"},tessellate:function(t){var e=this.controlPoint_,i=[];if(t)for(var n=0,r=e.length;n<r;++n){var s=e[n];i.push(s.x,0,s.y)}else for(var n=0,r=e.length;n<r;++n){var s=e[n];i.push(s.x,s.y)}return i}}),s}),t("x_ite/Components/Rendering/X3DGeometricPropertyNode",["x_ite/Components/Core/X3DNode","x_ite/Bits/X3DConstants"],function(t,e){"use strict";function i(i){t.call(this,i),this.addType(e.X3DGeometricPropertyNode)}return i.prototype=Object.assign(Object.create(t.prototype),{constructor:i}),i}),t("x_ite/Components/Rendering/X3DCoordinateNode",["x_ite/Components/Rendering/X3DGeometricPropertyNode","x_ite/Bits/X3DConstants","standard/Math/Geometry/Triangle3","standard/Math/Numbers/Vector3"],function(t,e,i,n){"use strict";function r(i){t.call(this,i),this.addType(e.X3DCoordinateNode)}return r.prototype=Object.assign(Object.create(t.prototype),{constructor:r,initialize:function(){t.prototype.initialize.call(this),this.point_.addInterest("set_point__",this),this.set_point__()},set_point__:function(){this.point=this.point_.getValue(),this.length=this.point_.length},isEmpty:function(){return 0===this.length},getSize:function(){return this.length},get1Point:function(t,e){if(t<this.length){const i=this.point;return t*=3,e.set(i[t],i[t+1],i[t+2])}return e.set(0,0,0)},addPoint:function(t,e){if(t<this.length){const i=this.point;t*=3,e.push(i[t],i[t+1],i[t+2],1)}else e.push(0,0,0,1)},addPoints:function(t,e){const i=this.point;for(var n=0,r=3*this.length;n<r;n+=3)t.push(i[n],i[n+1],i[n+2],1);for(var n=r,r=3*e;n<r;n+=3)t.push(0,0,0,1)},getNormal:function(){var t=new n(0,0,0),e=new n(0,0,0),r=new n(0,0,0);return function(s,o,a){var u=this.length;return s<u&&o<u&&a<u?i.normal(this.get1Point(s,t),this.get1Point(o,e),this.get1Point(a,r),new n(0,0,0)):new n(0,0,0)}}(),getQuadNormal:function(){var t=new n(0,0,0),e=new n(0,0,0),r=new n(0,0,0),s=new n(0,0,0);return function(o,a,u,l){var h=this.length;return o<h&&a<h&&u<h&&l<h?i.quadNormal(this.get1Point(o,t),this.get1Point(a,e),this.get1Point(u,r),this.get1Point(l,s),new n(0,0,0)):new n(0,0,0)}}()}),r}),t("x_ite/Components/NURBS/CoordinateDouble",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Rendering/X3DCoordinateNode","x_ite/Bits/X3DConstants"],function(t,e,i,n,r){"use strict";function s(t){n.call(this,t),this.addType(r.CoordinateDouble)}return s.prototype=Object.assign(Object.create(n.prototype),{constructor:s,fieldDefinitions:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.inputOutput,"point",new t.MFVec3d)]),getTypeName:function(){return"CoordinateDouble"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"coord"}}),s}),t("x_ite/Browser/Core/Shading",[],function(){"use strict";var t=0,e={POINT:t++,WIREFRAME:t++,FLAT:t++,GOURAUD:t++,PHONG:t++};return Object.preventExtensions(e),Object.freeze(e),Object.seal(e),e}),t("standard/Math/Geometry/Plane3",["standard/Math/Numbers/Vector3","standard/Math/Numbers/Matrix4"],function(t,e){"use strict";function i(t,e){this.normal=e.copy(),this.distanceFromOrigin=e.dot(t)}var n=new t(0,0,0),r=new t(0,0,0),s=new e;return i.prototype={constructor:i,copy:function(){var t=Object.create(i.prototype);return t.normal=this.normal.copy(),t.distanceFromOrigin=this.distanceFromOrigin,t},assign:function(t){return this.normal.assign(t.normal),this.distanceFromOrigin=t.distanceFromOrigin,this},set:function(t,e){return this.normal.assign(e),this.distanceFromOrigin=e.dot(t),this},multRight:function(t){return r.assign(this.normal).multiply(this.distanceFromOrigin),s.assign(t).inverse(),s.multMatrixDir(n.assign(this.normal)).normalize(),t.multVecMatrix(r),this.normal.assign(n),this.distanceFromOrigin=n.dot(r),this},multLeft:function(t){return r.assign(this.normal).multiply(this.distanceFromOrigin),s.assign(t).inverse(),s.multDirMatrix(n.assign(this.normal)).normalize(),t.multMatrixVec(r),this.normal.assign(n),this.distanceFromOrigin=n.dot(r),this},getDistanceToPoint:function(e){return t.dot(e,this.normal)-this.distanceFromOrigin},intersectsLine:function(t,e){var i=t.point,n=t.direction,r=n.dot(this.normal);if(0===r)return!1;var s=(this.distanceFromOrigin-this.normal.dot(i))/r;return e.x=i.x+n.x*s,e.y=i.y+n.y*s,e.z=i.z+n.z*s,!0},toString:function(){return this.normal.toString()+" "+this.distanceFromOrigin}},i}),t("x_ite/Components/Rendering/X3DGeometryNode",["x_ite/Fields","x_ite/Components/Core/X3DNode","x_ite/Bits/X3DConstants","x_ite/Browser/Core/Shading","standard/Math/Numbers/Color3","standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3","standard/Math/Numbers/Matrix3","standard/Math/Numbers/Matrix4","standard/Math/Geometry/Box3","standard/Math/Geometry/Plane3","standard/Math/Geometry/Triangle3","standard/Math/Algorithm"],function(t,e,i,n,r,s,o,a,u,l,h,c,d){"use strict";function g(n){e.call(this,n),this.addType(i.X3DGeometryNode),this.addChildObjects("transparent",new t.SFBool,"bbox_changed",new t.SFTime,"rebuild",new t.SFTime),this.transparent_.setAccessType(i.outputOnly),this.bbox_changed_.setAccessType(i.outputOnly),this.rebuild_.setAccessType(i.outputOnly),this.min=new o(0,0,0),this.max=new o(0,0,0),this.bbox=new l(this.min,this.max,!0),this.solid=!0,this.geometryType=3,this.flatShading=void 0,this.colorMaterial=!1,this.attribNodes=[],this.attribs=[],this.currentTexCoordNode=this.getBrowser().getDefaultTextureCoordinate(),this.texCoordParams={min:new o(0,0,0)},this.multiTexCoords=[],this.texCoords=g.createArray(),this.colors=g.createArray(),this.normals=g.createArray(),this.flatNormals=g.createArray(),this.vertices=g.createArray(),this.vertexCount=0,this.depth=Function.prototype,this.display=Function.prototype,this.displayParticles=Function.prototype}const p=new o(0,0,0),f=new o(0,0,0),m=new u,_=new u,y=[new o(0,0,1),new o(0,0,-1),new o(0,1,0),new o(0,-1,0),new o(1,0,0)];return g.createArray=function(){var t=[];return t.typedArray=new Float32Array,t.assign=function(t){this.length=0,Array.prototype.push.apply(this,t)},t.getValue=function(){return this.typedArray},t.shrinkToFit=function(){this.length!==this.typedArray.length?this.typedArray=new Float32Array(this):this.typedArray.set(this)},t},g.prototype=Object.assign(Object.create(e.prototype),{constructor:g,intersection:new o(0,0,0),uvt:{u:0,v:0,t:0},v0:new o(0,0,0),v1:new o(0,0,0),v2:new o(0,0,0),normal:new o(0,0,0),setup:function(){e.prototype.setup.call(this),this.addInterest("requestRebuild",this),this.rebuild_.addInterest("rebuild",this),this.rebuild()},initialize:function(){e.prototype.initialize.call(this),this.isLive().addInterest("set_live__",this);var t=this.getBrowser().getContext();if(this.primitiveMode=t.TRIANGLES,this.frontFace=t.CCW,this.attribBuffers=[],this.texCoordBuffers=[],this.colorBuffer=t.createBuffer(),this.normalBuffer=t.createBuffer(),this.vertexBuffer=t.createBuffer(),this.planes=[],this.geometryType>1)for(var i=0;i<5;++i)this.planes[i]=new h(o.Zero,y[0]);this.set_live__()},setGeometryType:function(t){this.geometryType=t},getGeometryType:function(){return this.geometryType},getBBox:function(){return this.bbox},setBBox:function(t){if(!t.equals(this.bbox)){t.getExtents(this.min,this.max),this.bbox.assign(t);for(var e=0;e<5;++e)this.planes[e].set(e%2?this.min:this.max,y[e]);this.bbox_changed_.addEvent()}},getMin:function(){return this.min},getMax:function(){return this.max},getMatrix:function(){return u.Identity},setPrimitiveMode:function(t){this.primitiveMode=t},getPrimitiveMode:function(){return this.primitiveMode},setSolid:function(t){this.solid=t},setCCW:function(t){this.frontFace=t?this.getBrowser().getContext().CCW:this.getBrowser().getContext().CW},getAttrib:function(){return this.attribNodes},getAttribs:function(){return this.attribs},setColors:function(t){this.colors.assign(t)},getColors:function(){return this.colors},setMultiTexCoords:function(t){var e=this.multiTexCoords;e.length=0,Array.prototype.push.apply(e,t)},getMultiTexCoords:function(){return this.multiTexCoords},getTexCoords:function(){return this.texCoords},setCurrentTexCoord:function(t){this.currentTexCoordNode=t||this.getBrowser().getDefaultTextureCoordinate()},setNormals:function(t){this.normals.assign(t)},getNormals:function(){return this.normals},setVertices:function(t){this.vertices.assign(t)},getVertices:function(){return this.vertices},buildTexCoords:function(){for(var t=this.getTexCoordParams(),e=t.min,i=t.Sindex,n=t.Tindex,r=t.Ssize,s=e[i],o=e[n],a=this.texCoords,u=this.vertices.getValue(),l=0,h=u.length;l<h;l+=4)a.push((u[l+i]-s)/r,(u[l+n]-o)/r,0,1);this.multiTexCoords.push(a)},getTexCoordParams:function(){var t=this.texCoordParams,e=this.getBBox(),i=e.size,n=i.x,r=i.y,s=i.z;return t.min.assign(e.center).subtract(i.divide(2)),n>=r&&n>=s?(t.Ssize=n,t.Sindex=0,t.Tindex=r>=s?1:2):r>=n&&r>=s?(t.Ssize=r,t.Sindex=1,t.Tindex=n>=s?0:2):(t.Ssize=s,t.Sindex=2,t.Tindex=n>=r?0:1),t},refineNormals:function(t,e,i){if(0===i)return e;var n=Math.cos(d.clamp(i,0,Math.PI)),r=[];for(var s in t)for(var a=t[s],u=0,l=a.length;u<l;++u){for(var h=a[u],c=e[h],g=new o(0,0,0),p=0;p<l;++p){var f=e[a[p]];f.dot(c)>=n&&g.add(f)}r[h]=g.normalize()}return r},isClipped:function(t,e){return e.some(function(e){return e.isClipped(t)})},transformLine:function(t){},transformMatrix:function(t){},intersectsLine:function(t,e,i,n){try{var r=!1;if(this.intersectsBBox(t)){this.transformLine(t),this.transformMatrix(m.assign(i));for(var a=this.multiTexCoords[0].getValue(),u=this.normals.getValue(),l=this.vertices.getValue(),h=this.uvt,c=this.v0,d=this.v1,g=this.v2,p=0,_=this.vertexCount;p<_;p+=3){var y=4*p;if(c.x=l[y],c.y=l[y+1],c.z=l[y+2],d.x=l[y+4],d.y=l[y+5],d.z=l[y+6],g.x=l[y+8],g.y=l[y+9],g.z=l[y+10],t.intersectsTriangle(c,d,g,h)){var v=h.u,b=h.v,w=h.t,C=new o(w*l[y]+v*l[y+4]+b*l[y+8],w*l[y+1]+v*l[y+5]+b*l[y+9],w*l[y+2]+v*l[y+6]+b*l[y+10]);if(this.isClipped(m.multVecMatrix(f.assign(C)),e))continue;var x=new s(w*a[y]+v*a[y+4]+b*a[y+8],w*a[y+1]+v*a[y+5]+b*a[y+9]),N=3*p,S=new o(w*u[N]+v*u[N+3]+b*u[N+6],w*u[N+1]+v*u[N+4]+b*u[N+7],w*u[N+2]+v*u[N+5]+b*u[N+8]);n.push({texCoord:x,normal:S,point:this.getMatrix().multVecMatrix(C)}),r=!0}}}return r}catch(t){return console.log(t),!1}},intersectsBBox:function(t){var e=this.planes,i=this.min,n=this.max,r=i.x,s=n.x,o=i.y,a=n.y,u=i.z,l=n.z,h=this.intersection;return!!(e[0].intersectsLine(t,h)&&h.x>=r&&h.x<=s&&h.y>=o&&h.y<=a)||(!!(e[1].intersectsLine(t,h)&&h.x>=r&&h.x<=s&&h.y>=o&&h.y<=a)||(!!(e[2].intersectsLine(t,h)&&h.x>=r&&h.x<=s&&h.z>=u&&h.z<=l)||(!!(e[3].intersectsLine(t,h)&&h.x>=r&&h.x<=s&&h.z>=u&&h.z<=l)||!!(e[4].intersectsLine(t,h)&&h.y>=o&&h.y<=a&&h.z>=u&&h.z<=l))))},intersectsBox:function(t,e,i){try{if(t.intersectsBox(this.bbox)){t.multRight(_.assign(this.getMatrix()).inverse()),this.transformMatrix(i);for(var n=this.vertices.getValue(),r=this.v0,s=this.v1,o=this.v2,a=0,u=this.vertexCount;a<u;a+=3){var l=4*a;if(r.x=n[l],r.y=n[l+1],r.z=n[l+2],s.x=n[l+4],s.y=n[l+5],s.z=n[l+6],o.x=n[l+8],o.y=n[l+9],o.z=n[l+10],t.intersectsTriangle(r,s,o)){if(e.length){if(this.isClipped(i.multVecMatrix(f.assign(r)),e))continue;if(this.isClipped(i.multVecMatrix(f.assign(s)),e))continue;if(this.isClipped(i.multVecMatrix(f.assign(o)),e))continue}return!0}}}return!1}catch(t){return console.log(t),!1}},set_live__:function(){this.isLive().getValue()?this.getBrowser().getBrowserOptions().Shading_.addInterest("set_shading__",this):this.getBrowser().getBrowserOptions().Shading_.removeInterest("set_shading__",this)},set_shading__:function(t){if(!(this.geometryType<2)){var e=this.getBrowser().getBrowserOptions().getShading()===n.FLAT;if(e!==this.flatShading){this.flatShading=e;var i=this.getBrowser().getContext();if(e&&!this.flatNormals.length){for(var r=this.frontFace===i.CW,s=this.flatNormals,o=this.vertices.getValue(),a=this.v0,u=this.v1,l=this.v2,h=this.normal,d=0,g=o.length;d<g;d+=12)c.normal(a.set(o[d],o[d+1],o[d+2]),u.set(o[d+4],o[d+5],o[d+6]),l.set(o[d+8],o[d+9],o[d+10]),h),r&&h.negate(),s.push(h.x,h.y,h.z,h.x,h.y,h.z,h.x,h.y,h.z);s.shrinkToFit()}i.bindBuffer(i.ARRAY_BUFFER,this.normalBuffer),i.bufferData(i.ARRAY_BUFFER,e?this.flatNormals.getValue():this.normals.getValue(),i.STATIC_DRAW)}}},requestRebuild:function(){this.rebuild_.addEvent()},rebuild:function(){this.clear(),this.build();for(var t=0,e=this.attribs.length;t<e;++t)this.attribs[t].shrinkToFit();for(var t=0,e=this.multiTexCoords.length;t<e;++t)this.multiTexCoords[t].shrinkToFit();this.colors.shrinkToFit(),this.normals.shrinkToFit(),this.vertices.shrinkToFit();var i=this.min,n=this.max,r=this.vertices.getValue();if(r.length){if(i.x===Number.POSITIVE_INFINITY)for(var t=0,e=r.length;t<e;t+=4)p.set(r[t],r[t+1],r[t+2]),i.min(p),n.max(p);this.bbox.setExtents(i,n)}else this.bbox.setExtents(i.set(0,0,0),n.set(0,0,0));if(this.bbox_changed_.addEvent(),this.geometryType>1){for(var t=0;t<5;++t)this.planes[t].set(t%2?i:n,y[t]);0===this.multiTexCoords.length&&(this.buildTexCoords(),this.texCoords.shrinkToFit())}this.set_shading__(this.getBrowser().getBrowserOptions().Shading_),this.transfer()},clear:function(){this.min.set(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this.max.set(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(var t=this.attribs,e=0,i=t.length;e<i;++e)t[e].length=0;for(var e=t.length,i=this.attribNodes.length;e<i;++e)t[e]=g.createArray();t.length=i,this.flatShading=void 0,this.colors.length=0,this.multiTexCoords.length=0,this.texCoords.length=0,this.normals.length=0,this.flatNormals.length=0,this.vertices.length=0},transfer:function(){for(var t=this.getBrowser().getContext(),e=this.vertices.length/4,i=this.attribBuffers.length,n=this.attribs.length;i<n;++i)this.attribBuffers.push(t.createBuffer());for(var i=0,n=this.attribs.length;i<n;++i)t.bindBuffer(t.ARRAY_BUFFER,this.attribBuffers[i]),t.bufferData(t.ARRAY_BUFFER,this.attribs[i].getValue(),t.STATIC_DRAW);for(var i=this.texCoordBuffers.length,n=this.multiTexCoords.length;i<n;++i)this.texCoordBuffers.push(t.createBuffer());for(var i=0,n=this.multiTexCoords.length;i<n;++i)t.bindBuffer(t.ARRAY_BUFFER,this.texCoordBuffers[i]),t.bufferData(t.ARRAY_BUFFER,this.multiTexCoords[i].getValue(),t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colors.getValue(),t.STATIC_DRAW),this.colorMaterial=Boolean(this.colors.length),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices.getValue(),t.STATIC_DRAW),this.vertexCount=e,this.vertexCount?(delete this.depth,delete this.display,delete this.displayParticles):(this.depth=Function.prototype,this.display=Function.prototype,this.displayParticles=Function.prototype)},traverse:function(t,e){},depth:function(t,e,i){i.enableVertexAttribute(t,this.vertexBuffer),t.drawArrays(this.primitiveMode,0,this.vertexCount)},display:function(t,e){try{var i=e.shaderNode,n=this.attribNodes,r=this.attribBuffers;e.geometryType=this.geometryType,e.colorMaterial=this.colorMaterial,i.enable(t),i.setLocalUniforms(t,e);for(var s=0,o=n.length;s<o;++s)n[s].enable(t,i,r[s]);if(this.colorMaterial&&i.enableColorAttribute(t,this.colorBuffer),i.enableTexCoordAttribute(t,this.texCoordBuffers),i.enableNormalAttribute(t,this.normalBuffer),i.enableVertexAttribute(t,this.vertexBuffer),i.wireframe)for(var s=0,o=this.vertexCount;s<o;s+=3)t.drawArrays(i.primitiveMode,s,3);else{var a=u.prototype.determinant3.call(e.modelViewMatrix)>0;t.frontFace(a?this.frontFace:this.frontFace===t.CCW?t.CW:t.CCW),e.transparent&&!this.solid?(t.enable(t.CULL_FACE),t.cullFace(t.FRONT),t.drawArrays(i.primitiveMode,0,this.vertexCount),t.cullFace(t.BACK),t.drawArrays(i.primitiveMode,0,this.vertexCount)):(this.solid?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.drawArrays(i.primitiveMode,0,this.vertexCount))}for(var s=0,o=n.length;s<o;++s)n[s].disable(t,i);i.disableColorAttribute(t),i.disableTexCoordAttribute(t),i.disableNormalAttribute(t),i.disable(t)}catch(t){console.log(t)}},displayParticlesDepth:function(t,e,i,n,r){var t=e.renderer.getBrowser().getContext();i.enableVertexAttribute(t,this.vertexBuffer);for(var s=e.modelViewMatrix,o=s[12],a=s[13],l=s[14],h=0;h<r;++h){var c=n[h];s[12]=o,s[13]=a,s[14]=l,u.prototype.translate.call(s,c.position),i.setParticle(t,h,c,s,!1),t.drawArrays(i.primitiveMode,0,this.vertexCount)}},displayParticles:function(t,e,i,n){try{var r=e.shaderNode,s=this.attribNodes,o=this.attribBuffers;e.geometryType=this.geometryType,e.colorMaterial=this.colorMaterial,r.enable(t),r.setLocalUniforms(t,e);for(var a=0,l=s.length;a<l;++a)s[a].enable(t,r,o[a]);this.colorMaterial&&r.enableColorAttribute(t,this.colorBuffer),r.enableTexCoordAttribute(t,this.texCoordBuffers),r.enableNormalAttribute(t,this.normalBuffer),r.enableVertexAttribute(t,this.vertexBuffer);var h=e.materialNode,c=h||r.getCustom(),d=e.modelViewMatrix,g=d[12],p=d[13],f=d[14];if(r.wireframe)for(var m=0;m<n;++m){var _=i[m];d[12]=g,d[13]=p,d[14]=f,u.prototype.translate.call(d,_.position),r.setParticle(t,m,_,d,c);for(var a=0,l=this.vertexCount;a<l;a+=3)t.drawArrays(r.primitiveMode,a,3)}else{var y=u.prototype.determinant3.call(e.modelViewMatrix)>0;if(t.frontFace(y?this.frontFace:this.frontFace===t.CCW?t.CW:t.CCW),e.transparent&&!this.solid)for(var m=0;m<n;++m){var _=i[m];d[12]=g,d[13]=p,d[14]=f,u.prototype.translate.call(d,_.position),r.setParticle(t,m,_,d,c),t.enable(t.CULL_FACE),t.cullFace(t.FRONT),t.drawArrays(r.primitiveMode,0,this.vertexCount),t.cullFace(t.BACK),t.drawArrays(r.primitiveMode,0,this.vertexCount)}else{this.solid?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE);for(var m=0;m<n;++m){var _=i[m];d[12]=g,d[13]=p,d[14]=f,u.prototype.translate.call(d,_.position),r.setParticle(t,m,_,d,c),t.drawArrays(r.primitiveMode,0,this.vertexCount)}}}for(var a=0,l=s.length;a<l;++a)s[a].disable(t,r);r.disableColorAttribute(t),r.disableTexCoordAttribute(t),r.disableNormalAttribute(t),r.disable(t)}catch(t){console.log(t)}}}),g}),t("x_ite/Browser/NURBS/NURBS",["standard/Math/Numbers/Vector3","standard/Math/Numbers/Vector4"],function(t,e){"use strict";return{getTessellation:function(t,e){return t>0?t+1:t<0?-t*e+1:2*e+1},getClosed2D:function(t,e,i,n){var r=n.length;return!(i.length===r&&i[0]!==i[r-1]||!n[0].equals(n[r-1])||!this.isPeriodic(t,r,e))},getClosed:function(){var e=new t(0,0,0),i=new t(0,0,0);return function(t,n,r,s){var o=s.getSize();return!(r.length===o&&r[0]!==r[o-1]||!s.get1Point(0,e).equals(s.get1Point(o-1,i))||!this.isPeriodic(t,o,n))}}(),getUClosed:function(){var e=new t(0,0,0),i=new t(0,0,0);return function(t,n,r,s,o,a){for(var u=o.length===a.getSize(),l=0,h=r;l<h;++l){var c=l*n,d=l*n+n-1;if(u&&o[c]!==o[d])return!1;if(!a.get1Point(c,e).equals(a.get1Point(d,i)))return!1}return!!this.isPeriodic(t,n,s)}}(),getVClosed:function(){var e=new t(0,0,0),i=new t(0,0,0);return function(t,n,r,s,o,a){for(var u=o.length===a.getSize(),l=0,h=n;l<h;++l){var c=l,d=(r-1)*n+l;if(u&&o[c]!==o[d])return!1;if(!a.get1Point(c,e).equals(a.get1Point(d,i)))return!1}return!!this.isPeriodic(t,r,s)}}(),isPeriodic:function(t,e,i){if(i.length===e+t){for(var n=1,r=1,s=t;r<s;++r)n+=i[r]===i[0];if(n===t)return!1;for(var n=1,r=i.length-t,s=i.length-1;r<s;++r)n+=i[r]===i[s];if(n===t)return!1}return!0},getKnots:function(t,e,i,n){for(var r=[],s=0,o=n.length;s<o;++s)r.push(n[s]);var a=!0;if(r.length===i+e){a=!1;for(var u=0,s=1,o=r.length;s<o;++s)r[s]==r[s-1]?++u:u=0,u>e-1&&(a=!0),r[s-1]>r[s]&&(a=!0)}if(a)for(var s=0,o=i+e;s<o;++s)r[s]=s/(o-1);if(t)for(var s=1,o=e-1;s<o;++s)r.push(r[r.length-1]+(r[s]-r[s-1]));return r},getWeights:function(t,e,i,n){if(n.length===i){for(var r=[],s=0;s<i;++s)r.push(n[s]);if(t)for(var s=1,o=e-1;s<o;++s)r.push(r[s]);return r}},getUVWeights:function(t,e,i,n,r,s,o){if(o.length===r*s){for(var a=[],u=0;u<r;++u){var l=[];a.push(l);for(var h=0;h<s;++h)l.push(o[h*r+u]);if(e)for(var c=1,d=n-1;c<d;++c)l.push(l[c])}if(t)for(var c=1,d=i-1;c<d;++c)a.push(a[c]);return a}},getControlPoints2D:function(t,e,i){for(var n=[],r=i.length,s=0;s<r;++s)n.push(i[s].getValue());if(t)for(var s=1,o=e-1;s<o;++s)n.push(n[s]);return n},getControlPoints:function(e,i,n){for(var r=[],s=n.getSize(),o=0;o<s;++o)r.push(n.get1Point(o,new t(0,0,0)));if(e)for(var o=1,a=i-1;o<a;++o)r.push(r[o]);return r},getUVControlPoints:function(e,i,n,r,s,o,a){for(var u=[],l=0;l<s;++l){var h=[];u.push(h);for(var c=0;c<o;++c)h.push(a.get1Point(c*s+l,new t(0,0,0)));if(i)for(var d=1,g=r-1;d<g;++d)h.push(h[d])}if(e)for(var d=1,g=n-1;d<g;++d)u.push(u[d]);return u},getTexControlPoints:function(t,i,n,r,s,o,a){for(var u=[],l=0;l<s;++l){var h=[];u.push(h);for(var c=0;c<o;++c)h.push(a.get1Point(c*s+l,new e(0,0,0,0)));if(i)for(var d=1,g=r-1;d<g;++d)h.push(h[d])}if(t)for(var d=1,g=n-1;d<g;++d)u.push(u[d]);return u}}}),t("x_ite/Components/NURBS/X3DParametricGeometryNode",["x_ite/Components/Rendering/X3DGeometryNode","x_ite/Bits/X3DConstants","x_ite/Browser/NURBS/NURBS"],function(t,e,i){"use strict";function n(i){t.call(this,i),this.addType(e.X3DParametricGeometryNode)}return n.prototype=Object.assign(Object.create(t.prototype),{constructor:n,getKnots:function(t,e,n,r){return i.getKnots(t,e,n,r)}}),n}),t("x_ite/Components/Rendering/X3DLineGeometryNode",["x_ite/Components/Rendering/X3DGeometryNode","x_ite/Bits/X3DConstants","standard/Math/Numbers/Matrix4"],function(t,e,i){"use strict";function n(e){t.call(this,e)}return n.prototype=Object.assign(Object.create(t.prototype),{constructor:n,getShader:function(t){return t.getLineShader()},intersectsLine:function(t,e,i,n){return!1},intersectsBox:function(t,e,i){return!1},display:function(t,e){try{var i=e.renderer.getBrowser(),n=e.shaderNode,r=this.attribNodes,s=this.attribBuffers;n===i.getDefaultShader()&&(n=this.getShader(i)),e.geometryType=this.getGeometryType(),e.colorMaterial=this.getColors().length,n.enable(t),n.setLocalUniforms(t,e);for(var o=0,a=r.length;o<a;++o)r[o].enable(t,n,s[o]);this.colors.length&&n.enableColorAttribute(t,this.colorBuffer),n.enableVertexAttribute(t,this.vertexBuffer),t.drawArrays(n.primitiveMode===t.POINTS?t.POINTS:this.primitiveMode,0,this.vertexCount);for(var o=0,a=r.length;o<a;++o)r[o].disable(t,n);n.disableColorAttribute(t),n.disable(t)}catch(t){console.log(t)}},displayParticles:function(t,e,n,r){try{var s=e.renderer.getBrowser(),o=e.shaderNode,a=this.attribNodes,u=this.attribBuffers;o!==s.getDefaultShader()&&o!==s.getShadowShader()||(o=this.getShader(s)),e.geometryType=this.getGeometryType(),e.colorMaterial=this.colors.length,o.enable(t),o.setLocalUniforms(t,e);for(var l=0,h=a.length;l<h;++l)a[l].enable(t,o,u[l]);this.colors.length&&o.enableColorAttribute(t,this.colorBuffer),o.enableVertexAttribute(t,this.vertexBuffer);for(var c=e.modelViewMatrix,d=c[12],g=c[13],p=c[14],f=o.primitiveMode===t.POINTS?t.POINTS:this.primitiveMode,m=0;m<r;++m)c[12]=d,c[13]=g,c[14]=p,i.prototype.translate.call(c,n[m].position),t.uniformMatrix4fv(o.x3d_ModelViewMatrix,!1,c),t.drawArrays(f,0,this.vertexCount);for(var l=0,h=a.length;l<h;++l)a[l].disable(t,o);o.disableColorAttribute(t),o.disable(t)}catch(t){console.log(t)}}}),n}),t("nurbs/src/utils/is-ndarray",[],function(){"use strict";return function(t){return!!t&&(!!t.dtype&&new RegExp("function View[0-9]+d(:?"+t.dtype+")+").test(String(t.constructor)))}}),t("nurbs/src/utils/is-ndarray-like",[],function(){"use strict";return function(t){return!!t&&(void 0!==t.data&&Array.isArray(t.shape)&&void 0!==t.offset&&void 0!==t.stride)}}),t("nurbs/src/utils/is-array-like",[],function(){"use strict";return function(t){return Array.isArray(t)||ArrayBuffer.isView(t)||void 0!==t.length}}),t("nurbs/src/utils/infer-type",["nurbs/src/utils/is-ndarray","nurbs/src/utils/is-ndarray-like","nurbs/src/utils/is-array-like"],function(t,e,i){"use strict";function n(r){if(r){if(t(r)||e(r))return"generic"===r.dtype?n.GENERIC_NDARRAY:n.NDARRAY;if(i(r)){for(var s=r;i(s[0]);s=s[0]);return"x"in s?n.ARRAY_OF_OBJECTS:n.ARRAY_OF_ARRAYS}throw new Error("Unhandled data type. Got type: "+typeof r)}}return n.ARRAY_OF_OBJECTS="Obj",n.ARRAY_OF_ARRAYS="Arr",n.NDARRAY="Nd",n.GENERIC_NDARRAY="GenNd",n.PACKED="PackArr",n}),t("nurbs/src/utils/cache-key",["nurbs/src/utils/is-array-like"],function(t){"use strict";function e(t){return t[0].toUpperCase()+t.slice(1)}return function(i,n,r,s,o,a){var u,l=[],h=!1;for(u=0;u<i.splineDimension;u++){var c=t(i.knots)&&t(i.knots[u]);c&&(h=!0),l.push("Deg"+i.degree[u]+(c?"":"Uniform")+e(i.boundary[u]))}var d=[[h?"NU":"",i.weights?"RBS":"BS"].join("")+i.dimension+"D",l.join("_")];return s&&d.push(s+"Pts"),o&&d.push(o+"Wts"),a&&d.push(a+"Kts"),n&&d.push("debug"),r&&d.push("chk"),d.join("_")}}),t("nurbs/src/utils/variable",[],function(){"use strict";var t=function t(e,i){return function(i,n){void 0===i||Array.isArray(i)||(i=[i]);for(var r=[],s=0;s<i.length;s++)r.push(t.sum(i[s]));if(n)for(i=0;i<r.length;i++)void 0!==n[i]&&(r[i]="("+r[i]+" + "+n[i]+") % "+n[i]);return e+r.join("_")}};return t.sum=function(t){return t=Array.isArray(t)?t:[t],t=t.filter(function(t){return void 0!==t&&0!==t}),0===t.length&&t.push(0),t.join(" + ")},t}),t("nurbs/src/utils/create-accessors",["nurbs/src/utils/infer-type","nurbs/src/utils/variable"],function(t,e){"use strict";function i(t){return function(i,n){void 0===i||Array.isArray(i)||(i=[i]);for(var r=[],s=0;s<i.length;s++)r.push(e.sum(i[s]));if(n)for(i=0;i<r.length;i++)void 0!==n[i]&&(r[i]="("+r[i]+" + "+n[i]+") % "+n[i]);return t(r)}}function n(e,n){if(n)switch(t(n)){case t.ARRAY_OF_OBJECTS:return i(function(t){var i=t.pop();return e+"["+t.join("][")+"]"+r[i]});case t.ARRAY_OF_ARRAYS:return i(function(t){return e+"["+t.join("][")+"]"});case t.GENERIC_NDARRAY:return i(function(t){return e+".get("+t.join(",")+")"});case t.NDARRAY:return i(function(t){for(var i=[e+"Offset"],n=0;n<t.length;n++)i.push(e+"Stride"+n+" * ("+t[n]+")");return e+"["+i.join(" + ")+"]"});case t.PACKED:default:return}}var r=[".x",".y",".z",".w"];return function(t){var e={},i=n("x",t.points);i&&(e.point=i);var i=n("w",t.weights);i&&(e.weight=i);var i=n("k",t.knots);return i&&(e.knot=i),e}}),t("nurbs/src/numerical-derivative",[],function(){"use strict";var t=[],e=[];return function(i,n,r){if(1!==n)throw new Error("Numerical derivative not implemented for order n = "+n+".");var s,o=void 0===arguments[this.splineDimension+3]?1e-4:arguments[this.splineDimension+3];for(t.length=this.splineDimension,s=0;s<this.splineDimension;s++)t[s+1]=arguments[s+3];var a,u,l,h=this.domain,c=h[r][0],d=h[r][1],g=t[r+1],p=(d-c)*o;for("closed"===this.boundary[r]?(l=d-c,a=c+(g-c-p+l)%l,u=c+(g-c+p+l)%l,p*=2):(a=Math.min(d,Math.max(c,g-p)),u=Math.min(d,Math.max(c,g+p)),p=u-a),t[r+1]=a,t[0]=e,this.evaluate.apply(null,t),t[r+1]=u,t[0]=i,this.evaluate.apply(null,t),s=0;s<this.dimension;s++)i[s]=(i[s]-e[s])/p;return i}}),t("nurbs/src/utils/ndloop",[],function(){"use strict";return function(t,e){for(var i=1,n=0,r=[];n<t.length;n++)i*=Array.isArray(t[n])?t[n][1]-t[n][0]:t[n],r[n]=Array.isArray(t[n])?t[n][0]:0;for(var s=0;s<i;s++)for(e(r.slice()),n=t.length-1;n>=0;n--){if(r[n]!==(Array.isArray(t[n])?t[n][1]:t[n])-1){r[n]++;break}r[n]=Array.isArray(t[n])?t[n][0]:0}}}),t("nurbs/src/utils/accessor-preamble",["nurbs/src/utils/infer-type"],function(t){"use strict";return function(e,i,n,r){var s=[];switch(t(r)){case t.NDARRAY:s.push("  var "+i+" = "+n+".data;"),s.push("  var "+i+"Offset = "+n+".offset;");for(var o=0;o<r.dimension;o++)s.push("  var "+i+"Stride"+o+" = "+n+".stride["+o+"];");break;case t.ARRAY_OF_OBJECTS:case t.ARRAY_OF_ARRAYS:s.push("  var "+i+" = "+n+";")}return s.join("\n")}}),t("nurbs/src/utils/size-getter",["nurbs/src/utils/is-ndarray-like"],function(t){"use strict";return function(e,i,n){if(e){if(t(e))return i+".shape["+n+"]";for(var r=i,s=0;s<n;s++)r+="[0]";return r+".length"}return"this.size["+n+"]"}}),t("nurbs/src/evaluate",["nurbs/src/utils/ndloop","nurbs/src/utils/variable","nurbs/src/utils/accessor-preamble","nurbs/src/utils/infer-type","nurbs/src/utils/is-array-like","nurbs/src/utils/size-getter"],function(t,e,i,n,r,s){"use strict";var o={},a={};return function(u,l,h,c,d,g,p){function f(t){z.push("  "+(t||""))}function m(t){c&&f(t)}function _(t,e,i){return"("+t+") ? ("+e+") : ("+i+")"}var y,v,b,w,C,x,N=l.splineDimension,S=l.points,F=l.degree,O=l.weights,D=void 0!==O,V=l.knots,B=l.dimension,R=l.boundary;if(void 0!==p&&null!==p){Array.isArray(p)||(p=[p]);var T=0;for(y=0;y<N;y++)void 0===p[y]&&(p[y]=0),T+=p[y];if(D&&T>1)throw new Error("Analytical derivative not implemented for rational b-splines with order n = "+T+".")}g&&(u="Basis"+u),p&&(u="Der"+p.join("_")+"_"+u);var A=o[u];if(c)var P="function"==typeof c?c:console.log;if(A)return c&&P(a[u]),A.bind(l);var z=[],I="evaluate"+u,M=h.point;g&&(M=function(t,e){for(var i=[],n=0;n<t.length;n++){for(var r=t[n],s=[],o=0;o<r.length;o++)0!==r[o]&&s.push(r[o]);r=s.join(" + "),e[n]&&(r="("+r+" + "+e[n]+") % "+e[n]),i.push(r+" === "+G(n))}return"(("+i.join(" && ")+") ? 1 : 0)"});var k=h.weight,j=h.knot,U=e("k"),X=e("x"),E=e("w"),G=e("i"),q=e("t"),K=c?"domain":"d",Y=e(c?"size":"s"),L=e(c?"knotIndex":"j"),W=!0;for(C=0;C<N;C++)r(V)&&r(V[C])&&(W=!1);if(g)var Z=[];var J=[];for(y=0;y<N;y++)g&&Z.push(G([y])),J.push(q([y]));for(z.push("function "+I+" ("+(g?"":"out, ")+J.join(", ")+(g?", "+Z.join(", "):"")+") {"),f("var h, m, a, b;"),d&&(f("var "+K+" = this.domain;"),f("for (var i = 0; i < this.splineDimension; i++) {"),f("  a = arguments[i + 1];"),f("  if (a < "+K+"[i][0] || a > "+K+"[i][1] || a === undefined || isNaN(a)) {"),f("    throw new Error('Invalid Spline parameter in dimension '+i+'. Valid domain is ['+"+K+"[i][0]+', '+"+K+"[i][1]+']. but got t'+i+' = '+arguments[i + 1]+'.');"),f("  }"),f("}")),C=0;C<N;C++)f("var "+Y(C)+" = "+s(S,"this.points",C)+";");z.push(i(l,"x","this.points",S)),D&&z.push(i(l,"w","this.weights",O)),W||z.push(i(l,"k","this.knots",V));var H=[];for(C=0;C<N;C++)switch(n(V)){case n.NDARRAY:H[C]=!0;break;case n.ARRAY_OF_ARRAYS:H[C]=r(V[C])}for(C=0;C<N;C++)if(H[C])for(m("\n  // Bisect to locate the knot interval in dimension "+C+"\n"),f("var "+L(C)+" = 0;"),f("h = "+Y(C)+";"),f("while(h > "+L(C)+" + 1) {"),f("  m = 0.5 * (h + "+L(C)+") | 0;"),f("  if ("+j([C,"m"])+" > "+q(C)+") h = m;"),f("  else "+L(C)+" = m;"),f("}"),m("\n  // Fetch knots for dimension "+C+"\n"),
y=1-F[C];y<=F[C];y++)f("closed"===R[C]?y<0?"var "+U([C,y+F[C]-1])+" = "+_(L(C)+" < "+-y,j([C,0])+" + "+j([C,[Y(C),L(C),y]])+" - "+j([C,[Y(C)]]),j([C,[L(C),y]]))+";":y>0?"var "+U([C,y+F[C]-1])+" = "+_(L(C)+" + "+y+" > "+Y(C),j([C,Y(C)])+" + "+j([C,y+" + "+L(C)+" - "+Y(C)])+" - "+j([C,0]),j([C,[L(C),y]]))+";":"var "+U([C,y+F[C]-1])+" = "+j([C,[L(C),y]])+";":"var "+U([C,y+F[C]-1])+" = "+j([C,[L(C),y]])+";");else{for(m("\n  // Directly compute knot interval for dimension "+C+"\n"),"closed"===R[C]?f(L(C)+" = ("+q(C)+" | 0) % "+Y(C)+";"):(f(L(C)+" = ("+q(C)+" | 0);"),f("if ("+L(C)+" < "+F[C]+") "+L(C)+" = "+F[C]+";"),f("if ("+L(C)+" > "+Y(C)+" - 1) "+L(C)+" = "+Y(C)+" - 1;")),m("\n  // Compute and clamp knots for dimension "+C+"\n"),y=1-F[C];y<=F[C];y++)x=U([C,y+F[C]-1]),f("var "+x+" = "+L(C)+" + "+y+";");if("clamped"===R[C])for(y=1-F[C];y<=F[C];y++)x=U([C,y+F[C]-1]),y<0&&f("if ("+x+" < "+F[C]+") "+x+" = "+F[C]+";"),y>0&&f("if ("+x+" > "+Y(C)+") "+x+" = "+Y(C)+";");"closed"===R[C]&&(m("\n  // Wrap the B-Spline parameter for closed boundary"),f(q(C)+" %= "+Y(C)+";"))}for(C=0,b=[];C<N;C++)b[C]=F[C]+1;for(D&&(m("\n  // Fetch weights\n"),t(b,function(t){for(var e=[],i=[],n=0;n<N;n++)e[n]=[L(n),t[n]-F[n]],"closed"===R[n]&&t[n]-F[n]<0&&(i[n]=Y(n));f("var "+E(t)+" = "+k(e,i)+";")})),c&&f(D?"\n  // Fetch points and project into homogeneous (weighted) coordinates\n":"\n  // Fetch points\n"),t(b,function(t){for(var e=[],i=[],n=0;n<N;n++)e[n]=[L(n),t[n]-F[n]],"closed"===R[n]&&t[n]-F[n]<0&&(i[n]=Y(n));if(g)f(D?"var "+X(t)+" = "+M(e,i)+" * "+E(t)+";":"var "+X(t)+" = "+M(e,i)+";");else for(n=0;n<B;n++){var r=t.concat(n);e[N]=n,f(D?"var "+X(r)+" = "+M(e,i)+" * "+E(t)+";":"var "+X(r)+" = "+M(e,i)+";")}}),m("\n"),m("// Perform De Boor's algorithm"),C=b.length-1;C>=0;C--)for(b[C]=[F[C],F[C]+1],y=0;y<F[C];y++)for(m("\n  // Degree "+F[C]+" evaluation in dimension "+C+", step "+(y+1)+"\n"),v=F[C];v>y;v--){var Q=p&&F[C]-y-p[C]<=0;Q?(f("m = 1 / ("+U([C,v-y+F[C]-1])+" - "+U([C,v-1])+");"),D&&(f("a = ("+q(C)+" - "+U([C,v-1])+") * m;"),f("b = 1 - a;"))):(f("a = ("+q(C)+" - "+U([C,v-1])+") / ("+U([C,v-y+F[C]-1])+" - "+U([C,v-1])+");"),f("b = 1 - a;")),D&&t(b,function(t){var e=t.slice(),i=t.slice();e[C]=v,i[C]=v-1,Q&&D&&f("h = "+E(e)+";"),f(E(e)+" = b * "+E(i)+" + a * "+E(e)+";")}),t(b,function(t){var e,i,n,r=t.slice(),s=t.slice();if(r[C]=v,s[C]=v-1,Q){var o=y+1;if(g)e=D?"h * "+E(s)+" / "+E(r)+" * ":"",i=X(r)+(D?" / h":""),n=X(s)+(D?" / "+E(s):""),f(X(r)+" = "+o+" * "+e+"("+i+" - "+n+") * m;");else{var a=r.slice(),u=s.slice();for(w=0;w<B;w++)a[N]=u[N]=w,e=D?"h * "+E(s)+" / "+E(r)+" * ":"",i=X(a)+(D?" / h":""),n=X(u)+(D?" / "+E(s):""),f(X(a)+" = "+o+" * "+e+"("+i+" - "+n+") * m;")}}else if(g)f(X(r)+" = b * "+X(s)+" + a * "+X(r)+";");else for(w=0;w<B;w++)r[N]=s[N]=w,f(X(r)+" = b * "+X(s)+" + a * "+X(r)+";")}),m("\n")}if(c&&f(D?"\n  // Project back from homogeneous coordinates and return final output\n":"\n  // Return final output\n"),g)f(D?"return "+X(F)+" / "+E(F)+";":"return "+X(F)+";");else for(C=0;C<B;C++)f(D?"out["+C+"] = "+X(F.concat([C]))+" / "+E(F)+";":"out["+C+"] = "+X(F.concat([C]))+";");if(g||f("return out;"),z.push("}"),c){var $=z.join("\n");P($),a[u]=$}var tt=new Function([z.join("\n"),"; return ",I].join(""))();return o[u]=tt,tt.bind(l)}}),t("nurbs/src/transform",["nurbs/src/utils/accessor-preamble","nurbs/src/utils/size-getter","nurbs/src/utils/variable"],function(t,e,i){"use strict";var n={};return function(r,s,o,a){var u,l,h,c,d,g,p,f,m=n[r];if(m)return m.bind(s);var _=[],y="transform"+r;_.push("function "+y+"(m) {"),_.push("var i, w;"),_.push(t(s,"x","this.points",s.points));var v=i(a?"size":"s");for(u=0;u<s.splineDimension;u++)_.push("var "+v(u)+" = "+e(s.points,"this.points",u)+";");for(c=[],u=0;u<s.splineDimension;u++)h="i"+u,c.push(h),_.push("for ("+h+" = "+v(u)+"- 1; "+h+" >= 0; "+h+"--) {");for(u=0;u<s.dimension;u++)_.push("x"+u+" = "+o.point(c.concat([u])));for(d=[],u=0;u<s.dimension;u++)d.push("m["+((s.dimension+1)*(u+1)-1)+"] * x"+u);for(d.push("m["+((s.dimension+1)*(s.dimension+1)-1)+"]"),_.push("var w = ("+d.join(" + ")+") || 1.0;"),u=0;u<s.dimension;u++){for(d=[],g=s.dimension,l=0;l<g;l++)d.push("m["+(l*(g+1)+u)+"] * x"+l);d.push("m["+(l*(g+1)+u)+"]"),f=o.point(c.concat([u])),p="("+d.join(" + ")+") / w",_.push(f+" = "+p+";")}for(u=s.splineDimension-1;u>=0;u--)_.push("}");_.push("return this;"),_.push("}");var b=new Function([_.join("\n"),"; return ",y].join(""))();return a&&console.log(_.join("\n")),n[r]=b,b.bind(s)}}),t("nurbs/src/support",["nurbs/src/utils/ndloop","nurbs/src/utils/variable","nurbs/src/utils/accessor-preamble","nurbs/src/utils/infer-type","nurbs/src/utils/is-array-like","nurbs/src/utils/size-getter"],function(t,e,i,n,r,s){"use strict";var o={};return function(a,u,l,h,c){function d(t){C.push("  "+(t||""))}function g(t,e){d(void 0===e?"out["+R+++"] = "+t.join(" + ")+";":"out["+R+++"] = ("+t.join(" + ")+" + "+e+") % "+e+";")}var p=o[a];if(p)return p.bind(u);var f,m,_,y=u.degree,v=u.knots,b=u.splineDimension,w=u.boundary,C=[],x="support"+a,N=l.knot,S=e("t"),F=h?"domain":"d",O=e(h?"size":"s"),D=e(h?"knotIndex":"i"),V=!0;for(_=0;_<b;_++)r(v)&&r(v[_])&&(V=!1);var B=[];for(f=0;f<b;f++)B.push(S([f]));C.push("function "+x+" (out, "+B.join(", ")+") {");var R=0;for(d("var h, m;"),d("var c = 0;"),c&&(d("var "+F+" = this.domain;"),d("for (var i = 0; i < this.splineDimension; i++) {"),d("  a = arguments[i + 1];"),d("  if (a < "+F+"[i][0] || a > "+F+"[i][1] || a === undefined || isNaN(a)) {"),d("    throw new Error('Invalid Spline parameter in dimension '+i+'. Valid domain is ['+"+F+"[i][0]+', '+"+F+"[i][1]+']. but got t'+i+' = '+arguments[i + 1]+'.');"),d("  }"),d("}")),_=0;_<b;_++)d("var "+O(_)+" = "+s(u.points,"this.points",_)+";");V||C.push(i(u,"k","this.knots",v));var T=[];for(_=0;_<b;_++)switch(n(v)){case n.NDARRAY:T[_]=!0;break;case n.ARRAY_OF_ARRAYS:T[_]=r(v[_])}for(_=0;_<b;_++)T[_]?(d("var "+D(_)+" = 0;"),d("h = "+O(_)+";"),d("while(h > "+D(_)+" + 1) {"),d("  m = 0.5 * (h + "+D(_)+") | 0;"),d("  if ("+N([_,"m"])+" > "+S(_)+") h = m;"),d("  else "+D(_)+" = m;"),d("}")):"closed"===w[_]?d(D(_)+" = ("+S(_)+" | 0) % "+O(_)+";"):(d(D(_)+" = ("+S(_)+" | 0);"),d("if ("+D(_)+" < "+y[_]+") "+D(_)+" = "+y[_]+";"),d("if ("+D(_)+" > "+O(_)+" - 1) "+D(_)+" = "+O(_)+" - 1;"));for(_=0,m=[];_<b;_++)m[_]=y[_]+1;t(m,function(t){for(var e=[],i=[],n=0;n<b;n++)e[n]=[D(n),t[n]-y[n]],"closed"===w[n]&&t[n]-y[n]<0&&(i[n]=O(n));for(n=0;n<b;n++)g(e[n],i[n])}),d("out.length = "+R+";"),d("return out;"),C.push("}"),h&&console.log(C.join("\n"));var A=new Function([C.join("\n"),"; return ",x].join(""))();return o[a]=A,A.bind(u)}}),t("nurbs/extras/sample",[],function(){"use strict";function t(t,e){var i=e[0],n=e[1],r=e[2],s=Math.sqrt(i*i+n*n+r*r);return s>0&&(t[0]=e[0]/s,t[1]=e[1]/s,t[2]=e[2]/s),t}function e(t,e,i){var n=e[0],r=e[1],s=e[2],o=i[0],a=i[1],u=i[2];return t[0]=r*u-s*a,t[1]=s*o-n*u,t[2]=n*a-r*o,t}var i=[],n=[];return function(r,s,o){r=r||{},o=o||{};var a=r.points=r.points||[],u=r.normals=r.normals||[],l=r.faces=r.faces||[],h=s.dimension;if(Array.isArray(o.resolution))var c=o.resolution;else var d=void 0===o.resolution?31:o.resolution,c=new Array(s.splineDimension).fill(d);var g=3===h&&(void 0===o.generateNormals||o.generateNormals);switch(s.splineDimension){case 1:for(var p=c[0],f="closed"===s.boundary[0],m=p+!f,_=m*h,y=s.evaluator([1,0]),v=o.domain||s.domain,b=v[0],w=0;w<m;++w){var C=b[0]+(b[1]-b[0])*w/p,x=w*h;s.evaluate(i,C);for(var N=0;N<h;++N)a[x+N]=i[N]}a.length=_;break;case 2:for(var p=c[0],S=c[1],f="closed"===s.boundary[0],F="closed"===s.boundary[1],m=p+!f,O=S+!F,D=m*O*3,_=m*O*h,y=s.evaluator([1,0]),V=s.evaluator([0,1]),v=o.domain||s.domain,b=v[0],B=v[1],w=0;w<m;++w)for(var C=b[0]+(b[1]-b[0])*w/p,R=0;R<O;++R){var T=B[0]+(B[1]-B[0])*R/S,x=(w+m*R)*h;s.evaluate(i,C,T);for(var N=0;N<h;++N)a[x+N]=i[N];g&&(t(i,e(i,y(i,C,T),V(n,C,T))),u[x]=i[0],u[x+1]=i[1],u[x+2]=i[2])}u.length=D,a.length=_;for(var A=0,w=0;w<p;++w){var P=w,z=w+1;f&&(z%=p);for(var R=0;R<S;++R){var I=R,M=R+1;F&&(M%=S),l[A++]=P+m*I,l[A++]=z+m*I,l[A++]=z+m*M,l[A++]=P+m*I,l[A++]=z+m*M,l[A++]=P+m*M}}l.length=A;break;default:throw new Error("Can only sample curves and surfaces")}return r}}),t("nurbs/nurbs",["nurbs/src/utils/infer-type","nurbs/src/utils/cache-key","nurbs/src/utils/is-ndarray","nurbs/src/utils/is-ndarray-like","nurbs/src/utils/create-accessors","nurbs/src/numerical-derivative","nurbs/src/utils/is-array-like","nurbs/src/evaluate","nurbs/src/transform","nurbs/src/support","nurbs/extras/sample"],function(t,e,i,n,r,s,o,a,u,l,h){"use strict";function c(t){return void 0===t||null===t}function d(n,h,d,g,p,m){var _,y;!n||o(n)||i(n)?(m=m||{},this.weights=g,this.knots=d,this.degree=h,this.points=n,this.boundary=p,this.debug=m.debug,this.checkBounds=!!m.checkBounds,Object.defineProperty(this,"size",{value:m.size,writable:!0,configurable:!0})):(m=n,this.debug=n.debug,this.checkBounds=!!n.checkBounds,this.weights=n.weights,this.knots=n.knots,this.degree=n.degree,this.boundary=n.boundary,this.points=n.points,Object.defineProperty(this,"size",{value:m.size,writable:!0,configurable:!0}));var v=t(this.points),b=t(this.weights),w=t(this.knots);if(this.points)switch(v){case t.GENERIC_NDARRAY:case t.NDARRAY:Object.defineProperties(this,{splineDimension:{value:this.points.shape.length-1,writable:!1,configurable:!0},dimension:{value:this.points.shape[this.points.shape.length-1],writable:!1,configurable:!0},size:{get:function(){return this.points.shape.slice(0,this.points.shape.length-1)},set:function(){throw new Error("Cannot assign to read only property 'size'")},configurable:!0}});break;case t.ARRAY_OF_OBJECTS:case t.ARRAY_OF_ARRAYS:var C=0,x=this.size||[];x.length=0;for(var N=this.points;o(N[0]);N=N[0])C++,x.push(N.length);if(0===C)throw new Error("Expected an array of points");Object.defineProperties(this,{splineDimension:{value:C,writable:!1,configurable:!0},dimension:{value:N.length,writable:!1,configurable:!0},size:{get:function(){var t=[];t.length=0;for(var e=0,i=this.points;e<this.splineDimension;e++,i=i[0])t[e]=i.length;return t},set:function(){throw new Error("Cannot assign to read only property 'size'")},configurable:!0}});break;case t.PACKED:default:throw new Error("Expected either a packed array, array of arrays, or ndarray of points")}else{if(void 0===this.size||null===this.size)throw new Error("Either points or a control hull size must be provided.");if(o(this.size)||Object.defineProperty(this,"size",{value:[this.size],writable:!0,configurable:!0}),0===this.size.length)throw new Error("`size` must be a number or an array of length at least one.");Object.defineProperties(this,{splineDimension:{value:this.size.length,writable:!1,configurable:!0},dimension:{value:0,writable:!1,configurable:!0}})}if(o(this.degree)){for(_=0;_<this.splineDimension;_++)if(c(this.degree[_]))throw new Error("Missing degree in dimension "+(_+1))}else{var S=!c(this.degree),F=c(this.degree)?2:this.degree;for(this.degree=[],_=0;_<this.splineDimension;_++)if(this.size[_]<=F){if(S)throw new Error("Expected at least "+(F+1)+" points for degree "+F+" spline in dimension "+(_+1)+" but got only "+this.size[_]);this.degree[_]=this.size[_]-1}else this.degree[_]=F}if(y="string"!=typeof this.boundary?"open":this.boundary,!f[y])throw new Error("Boundary type must be one of "+Object.keys(f)+". Got "+y);for(this.boundary=o(this.boundary)?this.boundary:[],this.boundary.length=this.splineDimension,_=0;_<this.splineDimension;_++)if(this.boundary[_]=c(this.boundary[_])?y:this.boundary[_],!f[y])throw new Error("Boundary type must be one of "+Object.keys(f)+". Got "+y+" for dimension "+(_+1));switch(w){case t.ARRAY_OF_ARRAYS:for(o(this.knots)&&this.knots.length>0&&!o(this.knots[0])&&(this.knots=[this.knots]),_=0;_<this.splineDimension;_++){if(this.size[_]<=this.degree[_])throw new Error("Expected at least "+(this.degree[_]+1)+" points in dimension "+(_+1)+" but got "+this.size[_]+".");if(o(this.knots[_])){if("closed"!==this.boundary[_]&&this.knots[_].length!==this.degree[_]+this.size[_]+1)throw new Error("Expected "+(this.degree[_]+this.size[_]+1)+" knots in dimension "+(_+1)+" but got "+this.knots[_].length+".");if("closed"===this.boundary[_]&&this.knots[_].length!==this.size[_]+1){if(!(this.knots[_].length===this.size[_]+this.degree[_]+1))throw new Error("Expected "+(this.size[_]+1)+" knots for closed spline in dimension "+(_+1)+" but got "+this.knots[_].length+".")}}}break;case t.NDARRAY:}var O=e(this,this.debug,this.checkBounds,v,b,w);if(O!==this.__cacheKey){this.__cacheKey=O;var D=r(this);this.evaluate=a(this.__cacheKey,this,D,this.debug,this.checkBounds,!1),this.transform=u(this.__cacheKey,this,D,this.debug),this.support=l(this.__cacheKey,this,D,this.debug,this.checkBounds),this.evaluator=function(t,e){return a(this.__cacheKey,this,D,this.debug,this.checkBounds,e,t)}}return this.numericalDerivative=s.bind(this),this}function g(){var t,e=[],i=this.points;i?n(i)&&(t=i.shape):t=this.size;for(var r=0;r<this.splineDimension;r++){var s=t?t[r]:i.length,o=this.degree[r],a="closed"===this.boundary[r];if(this.knots&&this.knots[r]){var u=this.knots[r];e[r]=[u[a?0:o],u[s]]}else e[r]=[a?0:o,s];i&&(i=i[0])}return e}function p(t,e,i,n,r,s){var o=function(t,e,i,n,r,s){return a(t,e,i,n,r,s),o},a=d.bind(o);return Object.defineProperty(o,"domain",{get:g}),a(t,e,i,n,r,s),o}var f={open:"open",closed:"closed",clamped:"clamped"};return p.sample=h,p}),t("nurbs",["nurbs/nurbs"],function(t){return t}),t("x_ite/Components/NURBS/NurbsCurve",["x_ite/Bits/X3DCast","x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/NURBS/X3DParametricGeometryNode","x_ite/Components/Rendering/X3DLineGeometryNode","x_ite/Bits/X3DConstants","x_ite/Browser/NURBS/NURBS","nurbs"],function(t,e,i,n,r,s,o,a,u){"use strict";function l(t){r.call(this,t),this.addType(o.NurbsCurve),this.setGeometryType(1),this.mesh={},this.sampleOptions={resolution:[]}}return l.prototype=Object.assign(Object.create(r.prototype),s.prototype,{constructor:l,fieldDefinitions:new n([new i(o.inputOutput,"metadata",new e.SFNode),new i(o.inputOutput,"tessellation",new e.SFInt32),new i(o.initializeOnly,"closed",new e.SFBool),new i(o.initializeOnly,"order",new e.SFInt32(3)),new i(o.initializeOnly,"knot",new e.MFDouble),new i(o.inputOutput,"weight",new e.MFDouble),new i(o.inputOutput,"controlPoint",new e.SFNode)]),getTypeName:function(){return"NurbsCurve"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"geometry"},initialize:function(){r.prototype.initialize.call(this),this.controlPoint_.addInterest("set_controlPoint__",this),this.setPrimitiveMode(this.getBrowser().getContext().LINES),this.setSolid(!1),this.set_controlPoint__()},set_controlPoint__:function(){this.controlPointNode&&this.controlPointNode.removeInterest("requestRebuild",this),this.controlPointNode=t(o.X3DCoordinateNode,this.controlPoint_),this.controlPointNode&&this.controlPointNode.addInterest("requestRebuild",this)},getTessellation:function(t){return a.getTessellation(this.tessellation_.getValue(),t-this.order_.getValue())},getClosed:function(t,e,i,n){return!!this.closed_.getValue()&&a.getClosed(t,e,i,n)},getWeights:function(t,e,i,n){return a.getWeights(t,e,i,n)},getControlPoints:function(t,e,i){return a.getControlPoints(t,e,i)},tessellate:function(){if(this.order_.getValue()<2)return[];if(!this.controlPointNode)return[];if(this.controlPointNode.getSize()<this.order_.getValue())return[];for(var t=this.getVertices(),e=[],i=0,n=t.length;i<n;i+=8)e.push(t[i],t[i+1],t[i+2]);return e.push(t[n-4],t[n-3],t[n-2]),e},build:function(){if(!(this.order_.getValue()<2)&&this.controlPointNode&&!(this.controlPointNode.getSize()<this.order_.getValue())){var t=this.getClosed(this.order_.getValue(),this.knot_,this.weight_,this.controlPointNode),e=this.getControlPoints(t,this.order_.getValue(),this.controlPointNode),i=this.getKnots(t,this.order_.getValue(),this.controlPointNode.getSize(),this.knot_),n=(i[i.length-1],i[0],this.getWeights(t,this.order_.getValue(),this.controlPointNode.getSize(),this.weight_)),r=this.order_.getValue()-1,s=this.surface=(this.surface||u)({boundary:["open"],degree:[r],knots:[i],weights:n,points:e,debug:!1});this.sampleOptions.resolution[0]=this.getTessellation(i.length);for(var o=u.sample(this.mesh,s,this.sampleOptions),a=o.points,l=this.getVertices(),h=3,c=a.length;h<c;h+=3){var d=h-3;l.push(a[d],a[d+1],a[d+2],1),l.push(a[h],a[h+1],a[h+2],1)}}}}),l}),t("x_ite/Components/NURBS/NurbsCurve2D",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/NURBS/X3DNurbsControlCurveNode","x_ite/Bits/X3DConstants","x_ite/Browser/NURBS/NURBS","nurbs"],function(t,e,i,n,r,s,o){"use strict";function a(t){n.call(this,t),this.addType(r.NurbsCurve2D),this.mesh={},this.sampleOptions={resolution:[]}}return a.prototype=Object.assign(Object.create(n.prototype),{constructor:a,fieldDefinitions:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.inputOutput,"tessellation",new t.SFInt32),new e(r.initializeOnly,"closed",new t.SFBool),new e(r.initializeOnly,"order",new t.SFInt32(3)),new e(r.initializeOnly,"knot",new t.MFDouble),new e(r.inputOutput,"weight",new t.MFDouble),new e(r.inputOutput,"controlPoint",new t.MFVec2d)]),getTypeName:function(){return"NurbsCurve2D"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"children"},getTessellation:function(t){return s.getTessellation(this.tessellation_.getValue(),t-this.order_.getValue())},getClosed:function(t,e,i,n){return!!this.closed_.getValue()&&s.getClosed2D(t,e,i,n)},getKnots:function(t,e,i,n){return s.getKnots(t,e,i,n)},getWeights:function(t,e,i,n){return s.getWeights(t,e,i,n)},getControlPoints:function(t,e,i){return s.getControlPoints2D(t,e,i)},tessellate:function(t){if(this.order_.getValue()<2)return[];if(this.controlPoint_.length<this.order_.getValue())return[];var e=this.getClosed(this.order_.getValue(),this.knot_,this.weight_,this.controlPoint_),i=this.getControlPoints(e,this.order_.getValue(),this.controlPoint_),n=this.getKnots(e,this.order_.getValue(),this.controlPoint_.length,this.knot_),r=(n[n.length-1],n[0],this.getWeights(e,this.order_.getValue(),this.controlPoint_.length,this.weight_)),s=this.order_.getValue()-1,a=this.surface=(this.surface||o)({boundary:["open"],degree:[s],knots:[n],weights:r,points:i,debug:!1});this.sampleOptions.resolution[0]=this.getTessellation(n.length);var u=o.sample(this.mesh,a,this.sampleOptions),l=u.points,h=[];if(t)for(var c=0,d=l.length;c<d;c+=2)h.push(l[c],0,l[c+1]);else for(var c=0,d=l.length;c<d;c+=2)h.push(l[c],l[c+1]);return h}}),a}),t("x_ite/Components/Interpolation/X3DInterpolatorNode",["x_ite/Components/Core/X3DChildNode","x_ite/Bits/X3DConstants","standard/Math/Algorithm"],function(t,e,i){"use strict";function n(i){t.call(this,i),this.addType(e.X3DInterpolatorNode)}return n.prototype=Object.assign(Object.create(t.prototype),{constructor:n,setup:function(){this.set_key__(),this.key_.length&&this.interpolate(0,0,0),t.prototype.setup.call(this)},initialize:function(){t.prototype.initialize.call(this),this.set_fraction_.addInterest("set_fraction__",this),this.key_.addInterest("set_key__",this)},set_fraction__:function(){var t=this.key_,e=t.length,n=this.set_fraction_.getValue();switch(e){case 0:return;case 1:return this.interpolate(0,0,0);default:if(n<=t[0])return this.interpolate(0,1,0);var r=i.upperBound(t,0,e,n,i.less);if(r!==e){var s=r-1,o=(n-t[s])/(t[r]-t[s]);this.interpolate(s,r,i.clamp(o,0,1))}else this.interpolate(e-2,e-1,1)}},set_key__:function(){this.set_keyValue__()},set_keyValue__:function(){},interpolate:function(){}}),n}),t("x_ite/Components/Interpolation/OrientationInterpolator",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Interpolation/X3DInterpolatorNode","x_ite/Bits/X3DConstants","standard/Math/Numbers/Rotation4"],function(t,e,i,n,r,s){"use strict";function o(t){n.call(this,t),this.addType(r.OrientationInterpolator)}return o.prototype=Object.assign(Object.create(n.prototype),{constructor:o,fieldDefinitions:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.inputOnly,"set_fraction",new t.SFFloat),new e(r.inputOutput,"key",new t.MFFloat),new e(r.inputOutput,"keyValue",new t.MFRotation),new e(r.outputOnly,"value_changed",new t.SFRotation)]),getTypeName:function(){return"OrientationInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){n.prototype.initialize.call(this),this.keyValue_.addInterest("set_keyValue__",this)},set_keyValue__:function(){var e=this.key_,i=this.keyValue_;i.length<e.length&&i.resize(e.length,i.length?i[i.length-1]:new t.SFRotation)},interpolate:function(){var t=new s(0,0,1,0),e=new s(0,0,1,0);return function(i,n,r){try{t.assign(this.keyValue_[i].getValue()),e.assign(this.keyValue_[n].getValue()),this.value_changed_=t.slerp(e,r)}catch(t){console.log(t)}}}()}),o}),t("x_ite/Components/NURBS/NurbsOrientationInterpolator",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Core/X3DChildNode","x_ite/Components/Interpolation/OrientationInterpolator","x_ite/Bits/X3DConstants","x_ite/Bits/X3DCast","x_ite/Browser/NURBS/NURBS","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","nurbs"],function(t,e,i,n,r,s,o,a,u,l,h){"use strict";function c(e){n.call(this,e),this.addType(s.NurbsOrientationInterpolator),this.addChildObjects("rebuild",new t.SFTime),this.interpolator=new r(e),this.mesh={},this.sampleOptions={resolution:[128]}}return c.prototype=Object.assign(Object.create(n.prototype),{constructor:c,fieldDefinitions:new i([new e(s.inputOutput,"metadata",new t.SFNode),new e(s.inputOnly,"set_fraction",new t.SFFloat),new e(s.inputOutput,"order",new t.SFInt32(3)),new e(s.inputOutput,"knot",new t.MFDouble),new e(s.inputOutput,"weight",new t.MFDouble),new e(s.inputOutput,"controlPoint",new t.SFNode),new e(s.outputOnly,"value_changed",new t.SFRotation)]),getTypeName:function(){return"NurbsOrientationInterpolator"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"children"},initialize:function(){n.prototype.initialize.call(this),this.order_.addInterest("requestRebuild",this),this.knot_.addInterest("requestRebuild",this),this.weight_.addInterest("requestRebuild",this),this.controlPoint_.addInterest("set_controlPoint__",this),this.rebuild_.addInterest("build",this),this.set_fraction_.addFieldInterest(this.interpolator.set_fraction_),this.interpolator.value_changed_.addFieldInterest(this.value_changed_),this.interpolator.setup(),this.set_controlPoint__()},set_controlPoint__:function(){this.controlPointNode&&this.controlPointNode.removeInterest("requestRebuild",this),this.controlPointNode=o(s.X3DCoordinateNode,this.controlPoint_),this.controlPointNode&&this.controlPointNode.addInterest("requestRebuild",this),this.requestRebuild()},getClosed:function(t,e,i,n){return!1},getKnots:function(t,e,i,n){return a.getKnots(t,e,i,n)},getWeights:function(t,e,i,n){return a.getWeights(t,e,i,n)},getControlPoints:function(t,e,i){return a.getControlPoints(t,e,i)},requestRebuild:function(){this.rebuild_.addEvent()},build:function(){if(!(this.order_.getValue()<2)&&this.controlPointNode&&!(this.controlPointNode.getSize()<this.order_.getValue())){var t=this.getClosed(this.order_.getValue(),this.knot_,this.weight_,this.controlPointNode),e=this.getControlPoints(t,this.order_.getValue(),this.controlPointNode),i=this.getKnots(t,this.order_.getValue(),this.controlPointNode.getSize(),this.knot_),n=i[i.length-1]-i[0],r=this.getWeights(t,this.order_.getValue(),this.controlPointNode.getSize(),this.weight_),s=this.order_.getValue()-1,o=this.surface=(this.surface||h)({boundary:["open"],degree:[s],knots:[i],weights:r,points:e,debug:!1}),a=h.sample(this.mesh,o,this.sampleOptions),c=a.points,d=this.interpolator;d.key_.length=0,d.keyValue_.length=0;for(var g=0,p=c.length-3;g<p;g+=3){var f=new u(c[g+3]-c[g+0],c[g+4]-c[g+1],c[g+5]-c[g+2]);d.key_.push(i[0]+g/(p-3+3*t)*n),d.keyValue_.push(new l(u.zAxis,f))}t&&(d.key_.push(i[0]+n),d.keyValue_.push(d.keyValue_[0]))}}}),c}),t("x_ite/Components/NURBS/X3DNurbsSurfaceGeometryNode",["x_ite/Components/NURBS/X3DParametricGeometryNode","x_ite/Bits/X3DConstants","x_ite/Bits/X3DCast","x_ite/Browser/NURBS/NURBS","nurbs"],function(t,e,i,n,r){"use strict";function s(i){t.call(this,i),this.addType(e.X3DNurbsSurfaceGeometryNode),this.tessellationScale=1,this.mesh={},this.sampleOptions={resolution:[]}}return s.prototype=Object.assign(Object.create(t.prototype),{constructor:s,initialize:function(){t.prototype.initialize.call(this),this.texCoord_.addInterest("set_texCoord__",this),this.controlPoint_.addInterest("set_controlPoint__",this),this.set_texCoord__(),this.set_controlPoint__()},set_texCoord__:function(){this.texCoordNode&&this.texCoordNode.removeInterest("requestRebuild",this),this.nurbsTexCoordNode&&this.nurbsTexCoordNode.removeInterest("requestRebuild",this),this.texCoordNode=i(e.X3DTextureCoordinateNode,this.texCoord_),this.nurbsTexCoordNode=i(e.NurbsTextureCoordinate,this.texCoord_),this.texCoordNode&&this.texCoordNode.addInterest("requestRebuild",this),this.nurbsTexCoordNode&&this.nurbsTexCoordNode.addInterest("requestRebuild",this)},set_controlPoint__:function(){this.controlPointNode&&this.controlPointNode.removeInterest("requestRebuild",this),this.controlPointNode=i(e.X3DCoordinateNode,this.controlPoint_),this.controlPointNode&&this.controlPointNode.addInterest("requestRebuild",this)},setTessellationScale:function(t){this.tessellationScale=t,this.requestRebuild()},getUTessellation:function(t){return Math.floor(n.getTessellation(this.uTessellation_.getValue(),t-this.uOrder_.getValue())*this.tessellationScale)},getVTessellation:function(t){return Math.floor(n.getTessellation(this.vTessellation_.getValue(),t-this.vOrder_.getValue())*this.tessellationScale)},getUClosed:function(t,e,i,r,s,o){return!!this.uClosed_.getValue()&&n.getUClosed(t,e,i,r,s,o)},getVClosed:function(t,e,i,r,s,o){return!!this.vClosed_.getValue()&&n.getVClosed(t,e,i,r,s,o)},getUVWeights:function(t,e,i,r,s,o,a){return n.getUVWeights(t,e,i,r,s,o,a)},getTexControlPoints:function(t,e,i,r,s,o,a){return n.getTexControlPoints(t,e,i,r,s,o,a)},getUVControlPoints:function(t,e,i,r,s,o,a){return n.getUVControlPoints(t,e,i,r,s,o,a)},build:function(){if(!(this.uOrder_.getValue()<2)&&!(this.vOrder_.getValue()<2)&&!(this.uDimension_.getValue()<this.uOrder_.getValue())&&!(this.vDimension_.getValue()<this.vOrder_.getValue())&&this.controlPointNode&&this.controlPointNode.getSize()===this.uDimension_.getValue()*this.vDimension_.getValue()){var t=this.getUClosed(this.uOrder_.getValue(),this.uDimension_.getValue(),this.vDimension_.getValue(),this.uKnot_,this.weight_,this.controlPointNode),e=this.getVClosed(this.vOrder_.getValue(),this.uDimension_.getValue(),this.vDimension_.getValue(),this.vKnot_,this.weight_,this.controlPointNode),i=this.getUVControlPoints(t,e,this.uOrder_.getValue(),this.vOrder_.getValue(),this.uDimension_.getValue(),this.vDimension_.getValue(),this.controlPointNode),n=this.getKnots(t,this.uOrder_.getValue(),this.uDimension_.getValue(),this.uKnot_),s=this.getKnots(e,this.vOrder_.getValue(),this.vDimension_.getValue(),this.vKnot_),o=(n[n.length-1],n[0],s[s.length-1],s[0],this.getUVWeights(t,e,this.uOrder_.getValue(),this.vOrder_.getValue(),this.uDimension_.getValue(),this.vDimension_.getValue(),this.weight_)),a=this.uOrder_.getValue()-1,u=this.vOrder_.getValue()-1,l=this.surface=(this.surface||r)({boundary:["open","open"],degree:[a,u],knots:[n,s],weights:o,points:i,debug:!1}),h=this.sampleOptions;h.resolution[0]=this.getUTessellation(n.length),h.resolution[1]=this.getVTessellation(s.length),h.generateNormals=!0,h.domain=void 0;for(var c=r.sample(this.mesh,l,h),d=c.faces,g=c.normals,p=c.points,f=this.getNormals(),m=this.getVertices(),_=0,y=d.length;_<y;++_){var v=3*d[_];f.push(g[v],g[v+1],g[v+2]),m.push(p[v],p[v+1],p[v+2],1)}this.buildNurbsTexCoords(t,e,this.uOrder_.getValue(),this.vOrder_.getValue(),n,s,this.uDimension_.getValue(),this.vDimension_.getValue(),l.domain),this.setSolid(this.solid_.getValue()),this.setCCW(!0)}},buildNurbsTexCoords:function(t,e,i,n,s,o,a,u,l){var h=this.sampleOptions;if(this.texCoordNode&&this.texCoordNode.getSize()===a*u)var c=i-1,d=n-1,g=s,p=o,f=void 0,m=this.getTexControlPoints(t,e,i,n,a,u,this.texCoordNode);else if(this.nurbsTexCoordNode&&this.nurbsTexCoordNode.isValid()){var _=this.nurbsTexCoordNode,c=_.uOrder_.getValue()-1,d=_.vOrder_.getValue()-1,g=this.getKnots(!1,_.uOrder_.getValue(),_.uDimension_.getValue(),_.uKnot_),p=this.getKnots(!1,_.vOrder_.getValue(),_.vDimension_.getValue(),_.vKnot_),f=this.getUVWeights(!1,!1,_.uOrder_.getValue(),_.vOrder_.getValue(),_.uDimension_.getValue(),_.vDimension_.getValue(),_.weight_);m=_.getControlPoints()}else{var c=1,d=1,g=[s[0],s[0],s[s.length-1],s[s.length-1]],p=[o[0],o[0],o[o.length-1],o[o.length-1]],f=void 0,m=[[[0,0,0,1],[0,1,0,1]],[[1,0,0,1],[1,1,0,1]]];h.domain=l}var y=this.surface=(this.surface||r)({boundary:["open","open"],degree:[c,d],knots:[g,p],weights:f,points:m});h.generateNormals=!1;for(var v=r.sample(this.mesh,y,h),b=v.faces,w=v.points,C=this.getTexCoords(),x=0,N=b.length;x<N;++x){var S=4*b[x];C.push(w[S],w[S+1],w[S+2],w[S+3])}this.getMultiTexCoords().push(this.getTexCoords())}}),s}),t("x_ite/Components/NURBS/NurbsPatchSurface",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/NURBS/X3DNurbsSurfaceGeometryNode","x_ite/Bits/X3DConstants"],function(t,e,i,n,r){"use strict";function s(t){n.call(this,t),this.addType(r.NurbsPatchSurface)}return s.prototype=Object.assign(Object.create(n.prototype),{constructor:s,fieldDefinitions:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.initializeOnly,"solid",new t.SFBool(!0)),new e(r.inputOutput,"uTessellation",new t.SFInt32),new e(r.inputOutput,"vTessellation",new t.SFInt32),new e(r.initializeOnly,"uClosed",new t.SFBool),new e(r.initializeOnly,"vClosed",new t.SFBool),new e(r.initializeOnly,"uOrder",new t.SFInt32(3)),new e(r.initializeOnly,"vOrder",new t.SFInt32(3)),new e(r.initializeOnly,"uDimension",new t.SFInt32),new e(r.initializeOnly,"vDimension",new t.SFInt32),new e(r.initializeOnly,"uKnot",new t.MFDouble),new e(r.initializeOnly,"vKnot",new t.MFDouble),new e(r.inputOutput,"weight",new t.MFDouble),new e(r.inputOutput,"texCoord",new t.SFNode),new e(r.inputOutput,"controlPoint",new t.SFNode)]),getTypeName:function(){return"NurbsPatchSurface"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"geometry"}}),s}),t("x_ite/Components/Interpolation/PositionInterpolator",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Interpolation/X3DInterpolatorNode","x_ite/Bits/X3DConstants","standard/Math/Numbers/Vector3"],function(t,e,i,n,r,s){"use strict";function o(t){n.call(this,t),this.addType(r.PositionInterpolator)}return o.prototype=Object.assign(Object.create(n.prototype),{constructor:o,fieldDefinitions:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.inputOnly,"set_fraction",new t.SFFloat),new e(r.inputOutput,"key",new t.MFFloat),new e(r.inputOutput,"keyValue",new t.MFVec3f),new e(r.outputOnly,"value_changed",new t.SFVec3f)]),getTypeName:function(){return"PositionInterpolator"},getComponentName:function(){return"Interpolation"},getContainerField:function(){return"children"},initialize:function(){n.prototype.initialize.call(this),this.keyValue_.addInterest("set_keyValue__",this)},set_keyValue__:function(){var e=this.key_,i=this.keyValue_;i.length<e.length&&i.resize(e.length,i.length?i[i.length-1]:new t.SFVec3f)},interpolate:function(){var t=new s(0,0,0);return function(e,i,n){this.value_changed_=t.assign(this.keyValue_[e].getValue()).lerp(this.keyValue_[i].getValue(),n)}}()}),o}),
t("x_ite/Components/NURBS/NurbsPositionInterpolator",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Core/X3DChildNode","x_ite/Components/Interpolation/PositionInterpolator","x_ite/Bits/X3DConstants","x_ite/Bits/X3DCast","x_ite/Browser/NURBS/NURBS","nurbs"],function(t,e,i,n,r,s,o,a,u){"use strict";function l(e){n.call(this,e),this.addType(s.NurbsPositionInterpolator),this.addChildObjects("rebuild",new t.SFTime),this.interpolator=new r(e),this.mesh={},this.sampleOptions={resolution:[128]}}return l.prototype=Object.assign(Object.create(n.prototype),{constructor:l,fieldDefinitions:new i([new e(s.inputOutput,"metadata",new t.SFNode),new e(s.inputOnly,"set_fraction",new t.SFFloat),new e(s.inputOutput,"order",new t.SFInt32(3)),new e(s.inputOutput,"knot",new t.MFDouble),new e(s.inputOutput,"weight",new t.MFDouble),new e(s.inputOutput,"controlPoint",new t.SFNode),new e(s.outputOnly,"value_changed",new t.SFVec3f)]),getTypeName:function(){return"NurbsPositionInterpolator"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"children"},initialize:function(){n.prototype.initialize.call(this),this.order_.addInterest("requestRebuild",this),this.knot_.addInterest("requestRebuild",this),this.weight_.addInterest("requestRebuild",this),this.controlPoint_.addInterest("set_controlPoint__",this),this.rebuild_.addInterest("build",this),this.set_fraction_.addFieldInterest(this.interpolator.set_fraction_),this.interpolator.value_changed_.addFieldInterest(this.value_changed_),this.interpolator.setup(),this.set_controlPoint__()},set_controlPoint__:function(){this.controlPointNode&&this.controlPointNode.removeInterest("requestRebuild",this),this.controlPointNode=o(s.X3DCoordinateNode,this.controlPoint_),this.controlPointNode&&this.controlPointNode.addInterest("requestRebuild",this),this.requestRebuild()},getClosed:function(t,e,i,n){return!1},getKnots:function(t,e,i,n){return a.getKnots(t,e,i,n)},getWeights:function(t,e,i,n){return a.getWeights(t,e,i,n)},getControlPoints:function(t,e,i){return a.getControlPoints(t,e,i)},requestRebuild:function(){this.rebuild_.addEvent()},build:function(){if(!(this.order_.getValue()<2)&&this.controlPointNode&&!(this.controlPointNode.getSize()<this.order_.getValue())){var e=this.getClosed(this.order_.getValue(),this.knot_,this.weight_,this.controlPointNode),i=this.getControlPoints(e,this.order_.getValue(),this.controlPointNode),n=this.getKnots(e,this.order_.getValue(),this.controlPointNode.getSize(),this.knot_),r=n[n.length-1]-n[0],s=this.getWeights(e,this.order_.getValue(),this.controlPointNode.getSize(),this.weight_),o=this.order_.getValue()-1,a=this.surface=(this.surface||u)({boundary:["open"],degree:[o],knots:[n],weights:s,points:i,debug:!1}),l=u.sample(this.mesh,a,this.sampleOptions),h=l.points,c=this.interpolator;c.key_.length=0,c.keyValue_.length=0;for(var d=0,g=h.length;d<g;d+=3)c.key_.push(n[0]+d/(g-3)*r),c.keyValue_.push(new t.SFVec3f(h[d],h[d+1],h[d+2]))}}}),l}),t("x_ite/Components/NURBS/NurbsSet",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Core/X3DChildNode","x_ite/Components/Grouping/X3DBoundedObject","x_ite/Bits/X3DConstants","x_ite/Bits/X3DCast"],function(t,e,i,n,r,s,o){"use strict";function a(t,e,i,n,r,s){function o(t){return a[getId(t)]}for(var a={},u=r;u<s;++u)a[getId(n[u])]=!0;return t.remove(e,i,o)}function u(t){n.call(this,t),r.call(this,t),this.addType(s.NurbsSet),this.geometryNodes=[]}return u.prototype=Object.assign(Object.create(n.prototype),r.prototype,{constructor:u,fieldDefinitions:new i([new e(s.inputOutput,"metadata",new t.SFNode),new e(s.inputOutput,"tessellationScale",new t.SFFloat(1)),new e(s.initializeOnly,"bboxSize",new t.SFVec3f(-1,-1,-1)),new e(s.initializeOnly,"bboxCenter",new t.SFVec3f),new e(s.inputOnly,"addGeometry",new t.MFNode),new e(s.inputOnly,"removeGeometry",new t.MFNode),new e(s.inputOutput,"geometry",new t.MFNode)]),getTypeName:function(){return"NurbsSet"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"children"},initialize:function(){n.prototype.initialize.call(this),r.prototype.initialize.call(this),this.tessellationScale_.addInterest("set_tessellationScale__",this),this.addGeometry_.addInterest("set_addGeometry__",this),this.removeGeometry_.addInterest("set_removeGeometry__",this),this.geometry_.addInterest("set_geometry__",this),this.set_geometry__()},set_tessellationScale__:function(){for(var t=Math.max(0,this.tessellationScale_.getValue()),e=0,i=this.geometryNodes.length;e<i;++e)this.geometryNodes[e].setTessellationScale(t)},set_addGeometry__:function(){this.addGeometry_.setTainted(!0),this.addGeometry_.erase(a(this.addGeometry_,0,this.addGeometry_.length,this.geometry_,0,this.geometry_.length),this.addGeometry_.length);for(var t=0,e=this.addGeometry_.length;t<e;++t)this.geometry_.push(this.addGeometry_[t]);this.addGeometry_.setTainted(!1)},set_removeGeometry__:function(){this.geometry_.erase(a(this.geometry_,0,this.geometry_.length,this.removeGeometry_,0,this.removeGeometry_.length),this.geometry__.length)},set_geometry__:function(){for(var t=0,e=this.geometryNodes.length;t<e;++t)this.geometryNodes[t].setTessellationScale(1);this.geometryNodes.length=0;for(var t=0,e=this.geometry_.length;t<e;++t){var i=o(s.X3DNurbsSurfaceGeometryNode,this.geometry_[t]);i&&this.geometryNodes.push(i)}this.set_tessellationScale__()}}),u}),t("standard/Math/Geometry/Line3",["standard/Math/Numbers/Vector3"],function(t){"use strict";function e(t,e){this.point=t.copy(),this.direction=e.copy()}return e.prototype={constructor:e,copy:function(){var t=Object.create(e.prototype);return t.point=this.point.copy(),t.direction=this.direction.copy(),t},assign:function(t){return this.point.assign(t.point),this.direction.assign(t.direction),this},set:function(t,e){return this.point.assign(t),this.direction.assign(e),this},setPoints:function(t,e){return this.point.assign(t),this.direction.assign(e).subtract(t).normalize(),this},multMatrixLine:function(t){return t.multMatrixVec(this.point),t.multMatrixDir(this.direction).normalize(),this},multLineMatrix:function(t){return t.multVecMatrix(this.point),t.multDirMatrix(this.direction).normalize(),this},getClosestPointToPoint:function(t,e){var i=e.assign(t).subtract(this.point),n=i.dot(this.direction);return e.assign(this.direction).multiply(n).add(this.point)},getClosestPointToLine:function(){var e=new t(0,0,0);return function(i,n){var r=this.point,s=i.point,o=this.direction,a=i.direction,u=t.dot(o,a);return!(Math.abs(u)>=1)&&(e.assign(s).subtract(r),u=(e.dot(o)-u*e.dot(a))/(1-u*u),n.assign(o).multiply(u).add(r),!0)}}(),getPerpendicularVector:function(e){var i=t.subtract(this.point,e);return i.subtract(this.direction.copy().multiply(t.dot(i,this.direction)))},intersectsTriangle:function(){var e=new t(0,0,0),i=new t(0,0,0);return function(t,n,r,s){var o=n.subtract(t),a=r.subtract(t);e.assign(this.direction).cross(a);var u=o.dot(e);if(0===u)return!1;var l=1/u;i.assign(this.point).subtract(t);var h=i.dot(e)*l;if(h<0||h>1)return!1;var c=i.cross(o),d=this.direction.dot(c)*l;return!(d<0||h+d>1)&&(s.u=h,s.v=d,s.t=1-h-d,!0)}}(),toString:function(){return this.point+", "+this.direction}},e.Points=function(i,n){var r=Object.create(e.prototype);return r.point=i.copy(),r.direction=t.subtract(n,i).normalize(),r},e}),t("standard/Math/Geometry/Triangle2",[],function(){"use strict";return{isPointInTriangle:function(t,e,i,n){var r=(e.y-i.y)*(t.x-i.x)+(i.x-e.x)*(t.y-i.y);if(0==r)return!1;var s=((e.y-i.y)*(n.x-i.x)+(i.x-e.x)*(n.y-i.y))/r;if(s<0||s>1)return!1;var o=((i.y-t.y)*(n.x-i.x)+(t.x-i.x)*(n.y-i.y))/r;if(o<0||o>1)return!1;var a=1-s-o;return!(a<0||a>1)}}}),t("x_ite/Components/NURBS/NurbsSurfaceInterpolator",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Core/X3DChildNode","x_ite/Components/NURBS/NurbsPatchSurface","x_ite/Bits/X3DConstants","standard/Math/Geometry/Line3","standard/Math/Geometry/Triangle2","standard/Math/Numbers/Vector3"],function(t,e,i,n,r,s,o,a,u){"use strict";function l(t){n.call(this,t),this.addType(s.NurbsSurfaceInterpolator),this.geometry=new r(t)}return l.prototype=Object.assign(Object.create(n.prototype),{constructor:l,fieldDefinitions:new i([new e(s.inputOutput,"metadata",new t.SFNode),new e(s.inputOnly,"set_fraction",new t.SFVec2f),new e(s.initializeOnly,"uOrder",new t.SFInt32(3)),new e(s.initializeOnly,"vOrder",new t.SFInt32(3)),new e(s.initializeOnly,"uDimension",new t.SFInt32),new e(s.initializeOnly,"vDimension",new t.SFInt32),new e(s.initializeOnly,"uKnot",new t.MFDouble),new e(s.initializeOnly,"vKnot",new t.MFDouble),new e(s.inputOutput,"weight",new t.MFDouble),new e(s.inputOutput,"controlPoint",new t.SFNode),new e(s.outputOnly,"normal_changed",new t.SFVec3f),new e(s.outputOnly,"position_changed",new t.SFVec3f)]),getTypeName:function(){return"NurbsSurfaceInterpolator"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"children"},initialize:function(){this.set_fraction_.addInterest("set_fraction__",this),this.uOrder_.addFieldInterest(this.geometry.uOrder_),this.vOrder_.addFieldInterest(this.geometry.vOrder_),this.uDimension_.addFieldInterest(this.geometry.uDimension_),this.vDimension_.addFieldInterest(this.geometry.vDimension_),this.uKnot_.addFieldInterest(this.geometry.uKnot_),this.vKnot_.addFieldInterest(this.geometry.vKnot_),this.weight_.addFieldInterest(this.geometry.weight_),this.controlPoint_.addFieldInterest(this.geometry.controlPoint_),this.geometry.uTessellation_=128,this.geometry.vTessellation_=128,this.geometry.uOrder_=this.uOrder_,this.geometry.vOrder_=this.vOrder_,this.geometry.uDimension_=this.uDimension_,this.geometry.vDimension_=this.vDimension_,this.geometry.uKnot_=this.uKnot_,this.geometry.vKnot_=this.vKnot_,this.geometry.weight_=this.weight_,this.geometry.controlPoint_=this.controlPoint_,this.geometry.setup()},set_fraction__:function(){var t=new u(0,0,0),e=new u(0,0,0),i=new u(0,0,0),n=new u(0,0,0),r=new o(u.Zero,u.zAxis),s={};return function(){for(var o=this.set_fraction_.getValue(),l=this.geometry.getTexCoords(),h=this.geometry.getNormals(),c=this.geometry.getVertices(),d=0,g=0,p=l.length;d<p;d+=12,g+=9)if(t.set(l[d+0],l[d+1],0),e.set(l[d+4],l[d+5],0),i.set(l[d+7],l[d+9],0),a.isPointInTriangle(t,e,i,o)&&(r.set(n.set(o.x,o.y,0),u.zAxis),r.intersectsTriangle(t,e,i,s))){var f=s.u,m=s.v,_=s.t,y=new u(_*h[g+0]+f*h[g+3]+m*h[g+6],_*h[g+1]+f*h[g+4]+m*h[g+7],_*h[g+2]+f*h[g+5]+m*h[g+8]),v=new u(_*c[d+0]+f*c[d+4]+m*c[d+8],_*c[d+1]+f*c[d+5]+m*c[d+9],_*c[d+2]+f*c[d+6]+m*c[d+10]);this.normal_changed_=y,this.position_changed_=v}}}()}),l}),t("x_ite/Components/Geometry3D/Extrusion",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Rendering/X3DGeometryNode","x_ite/Bits/X3DConstants","standard/Math/Geometry/Triangle3","standard/Math/Numbers/Vector2","standard/Math/Numbers/Vector3","standard/Math/Numbers/Rotation4","standard/Math/Numbers/Matrix4"],function(t,e,i,n,r,s,o,a,u,l){"use strict";function h(t){n.call(this,t),this.addType(r.Extrusion),this.creaseAngle_.setUnit("angle"),this.crossSection_.setUnit("length"),this.spine_.setUnit("length")}return h.prototype=Object.assign(Object.create(n.prototype),{constructor:h,fieldDefinitions:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.initializeOnly,"beginCap",new t.SFBool(!0)),new e(r.initializeOnly,"endCap",new t.SFBool(!0)),new e(r.initializeOnly,"solid",new t.SFBool(!0)),new e(r.initializeOnly,"ccw",new t.SFBool(!0)),new e(r.initializeOnly,"convex",new t.SFBool(!0)),new e(r.initializeOnly,"creaseAngle",new t.SFFloat),new e(r.inputOutput,"crossSection",new t.MFVec2f(new o(1,1),new o(1,-1),new o(-1,-1),new o(-1,1),new o(1,1))),new e(r.inputOutput,"orientation",new t.MFRotation(new u)),new e(r.inputOutput,"scale",new t.MFVec2f(new o(1,1))),new e(r.inputOutput,"spine",new t.MFVec3f(new a(0,0,0),new a(0,1,0)))]),getTypeName:function(){return"Extrusion"},getComponentName:function(){return"Geometry3D"},getContainerField:function(){return"geometry"},getClosedOrientation:function(){var t=this.orientation_;if(t.length){var e=t[0].getValue(),i=t[t.length-1].getValue();return e.equals(i)}return!0},createPoints:function(){var t=new a(1,1,1);return function(){for(var e=this.crossSection_,i=this.orientation_,n=this.scale_,r=this.spine_,s=[],o=this.createRotations(),u=0,l=r.length;u<l;++u){var h=o[u];if(i.length&&h.rotate(i[Math.min(u,i.length-1)].getValue()),n.length){var c=n[Math.min(u,n.length-1)].getValue();h.scale(t.set(c.x,1,c.y))}for(var d=0,g=e.length;d<g;++d){var p=e[d].getValue();s.push(h.multVecMatrix(new a(p.x,0,p.y)))}}return s}}(),createRotations:function(){var t=[],e=new a(0,0,0),i=new a(0,0,0),n=new a(0,0,0),r=new a(0,0,0),s=new a(0,0,0),o=new a(0,0,0),h=new u(0,0,1,0);return function(){for(var u=this.spine_,c=u.length,d=u[0].getValue(),g=u[u.length-1].getValue(),p=d.equals(g)&&this.getClosedOrientation(),f=t.length;f<c;++f)t[f]=new l;if(t.length=c,e.set(0,0,0),i.set(0,0,0),n.set(0,0,0),p){for(var f=1,m=c-2;f<m&&(i.assign(u[f].getValue()).subtract(u[m].getValue()).normalize(),i.equals(a.Zero));++f);for(var f=0,m=c-2;f<m&&(n.assign(u[f+1].getValue()).subtract(u[f].getValue()).cross(o.assign(u[m].getValue()).subtract(u[f].getValue())).normalize(),n.equals(a.Zero));++f);}else{for(var f=0,m=c-1;f<m&&(i.assign(u[f+1].getValue()).subtract(u[f].getValue()).normalize(),i.equals(a.Zero));++f);for(var f=1,m=c-1;f<m&&(n.assign(u[f+1].getValue()).subtract(u[f].getValue()).cross(o.assign(u[f-1].getValue()).subtract(u[f].getValue())).normalize(),n.equals(a.Zero));++f);}i.equals(a.Zero)&&i.set(0,1,0),n.equals(a.Zero)&&h.setFromToVec(a.yAxis,i).multVecRot(n.assign(a.zAxis)),e.assign(i).cross(n);var _=d;t[0].set(e.x,e.y,e.z,0,i.x,i.y,i.z,0,n.x,n.y,n.z,0,_.x,_.y,_.z,1),r.assign(i),s.assign(n);for(var f=1,m=c-1;f<m;++f){var _=u[f].getValue();i.assign(u[f+1].getValue()).subtract(u[f-1].getValue()).normalize(),n.assign(u[f+1].getValue()).subtract(_).cross(o.assign(u[f-1].getValue()).subtract(_)).normalize(),s.dot(n)<0&&n.negate(),i.equals(a.Zero)?i.assign(r):r.assign(i),n.equals(a.Zero)?n.assign(s):s.assign(n),e.assign(i).cross(n),t[f].set(e.x,e.y,e.z,0,i.x,i.y,i.z,0,n.x,n.y,n.z,0,_.x,_.y,_.z,1)}if(p)t[c-1].assign(t[0]);else{var _=g;i.assign(_).subtract(u[c-2].getValue()).normalize(),c>2&&n.assign(_).subtract(u[c-2].getValue()).cross(o.assign(u[c-3].getValue()).subtract(u[c-2].getValue())).normalize(),s.dot(n)<0&&n.negate(),i.equals(a.Zero)&&i.assign(r),n.equals(a.Zero)&&n.assign(s),e.assign(i).cross(n),t[c-1].set(e.x,e.y,e.z,0,i.x,i.y,i.z,0,n.x,n.y,n.z,0,_.x,_.y,_.z,1)}return t}}(),build:function(){var t=new o(0,0,0),e=new o(0,0,0),i=new o(0,0,0);return function(){function n(t,e){return t*d+e}var r=!this.ccw_.getValue(),u=this.crossSection_,l=this.spine_,h=l.length,c=this.getTexCoords();if(!(h<2||u.length<2)){this.getMultiTexCoords().push(c);var d=u.length,g=l[0].getValue(),p=l[h-1].getValue(),f=g.equals(p)&&this.getClosedOrientation(),m=u[0].getValue(),_=u[u.length-1].getValue(),y=m.equals(_);t.assign(u[0].getValue()),e.assign(u[0].getValue());for(var v=1,b=u.length;v<b;++v)t.min(u[v].getValue()),e.max(u[v].getValue());for(var w=i.assign(e).subtract(t),C=Math.max(w.x,w.y),x=y?u.length-1:u.length,N=[],S=[],F=this.createPoints(),O=0,b=F.length;O<b;++O)N[O]=[];for(var D=this.getNormals(),V=this.getVertices(),B=u.length-1,R=h-1,T=n(0,0),A=n(0,y?0:B),P=0;P<R;++P)for(var v=0;v<B;++v){var z=f&&P===h-2?0:P+1,I=y&&v===u.length-2?0:v+1,M=n(P,v),k=n(P,I),j=n(z,I),U=n(z,v),X=F[M],E=F[k],G=F[j],q=F[U],K=E.distance(G)>=1e-7,Y=q.distance(X)>=1e-7;if(r)var L=s.normal(G,E,X,new a(0,0,0)),W=s.normal(q,G,X,new a(0,0,0));else var L=s.normal(X,E,G,new a(0,0,0)),W=s.normal(X,G,q,new a(0,0,0));if(0==v&&(Y?T=M:(M=T,X=F[M])),v==u.length-2&&(K?A=k:(j=A,G=F[j])),K){if(Y)c.push(v/B,P/R,0,1);else{var Z=(P/R+(P+1)/R)/2;c.push(v/B,Z,0,1)}N[M].push(S.length),S.push(L),V.push(X.x,X.y,X.z,1),c.push((v+1)/B,P/R,0,1),N[k].push(S.length),S.push(L),V.push(E.x,E.y,E.z,1),c.push((v+1)/B,(P+1)/R,0,1),N[j].push(S.length),S.push(L),V.push(G.x,G.y,G.z,1)}if(Y){if(c.push(v/B,P/R,0,1),N[M].push(S.length),S.push(W),V.push(X.x,X.y,X.z,1),K)c.push((v+1)/B,(P+1)/R,0,1);else{var Z=((P+1)/R+P/R)/2;c.push((v+1)/B,Z,0,1)}N[j].push(S.length),S.push(W),V.push(G.x,G.y,G.z,1),c.push(v/B,(P+1)/R,0,1),N[U].push(S.length),S.push(W),V.push(q.x,q.y,q.z,1)}}S=this.refineNormals(N,S,this.creaseAngle_.getValue());for(var J=0;J<S.length;++J){var H=S[J];D.push(H.x,H.y,H.z)}if(C&&u.length>2){if(this.beginCap_.getValue()){for(var Q=0,$=[],tt=[],v=0;v<x;++v){var et=n(Q,x-1-v),it=F[et].copy();it.index=et,it.texCoord=o.subtract(u[x-1-v].getValue(),t).divide(C),$.push(it)}if(this.convex_.getValue()?s.triangulateConvexPolygon($,tt):s.triangulatePolygon($,tt),tt.length>=3){var H=s.normal(F[tt[0].index],F[tt[1].index],F[tt[2].index],new a(0,0,0));r&&H.negate(),this.addCap(c,H,F,tt)}}if(this.endCap_.getValue()){for(var Q=h-1,$=[],tt=[],v=0;v<x;++v){var et=n(Q,v),it=F[et].copy();it.index=et,it.texCoord=o.subtract(u[v].getValue(),t).divide(C),$.push(it)}if(this.convex_.getValue()?s.triangulateConvexPolygon($,tt):s.triangulatePolygon($,tt),tt.length>=3){var H=s.normal(F[tt[0].index],F[tt[1].index],F[tt[2].index],new a(0,0,0));r&&H.negate(),this.addCap(c,H,F,tt)}}}this.setSolid(this.solid_.getValue()),this.setCCW(this.ccw_.getValue())}}}(),addCap:function(t,e,i,n){for(var r=this.getNormals(),s=this.getVertices(),o=0;o<n.length;o+=3){var a=i[n[o].index],u=i[n[o+1].index],l=i[n[o+2].index],h=n[o].texCoord,c=n[o+1].texCoord,d=n[o+2].texCoord;t.push(h.x,h.y,0,1),t.push(c.x,c.y,0,1),t.push(d.x,d.y,0,1),r.push(e.x,e.y,e.z,e.x,e.y,e.z,e.x,e.y,e.z),s.push(a.x,a.y,a.z,1,u.x,u.y,u.z,1,l.x,l.y,l.z,1)}}}),h}),t("x_ite/Components/NURBS/NurbsSweptSurface",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Geometry3D/Extrusion","x_ite/Components/NURBS/X3DParametricGeometryNode","x_ite/Bits/X3DConstants","x_ite/Bits/X3DCast"],function(t,e,i,n,r,s,o){"use strict";function a(t){r.call(this,t),this.addType(s.NurbsSweptSurface),this.extrusion=new n(t)}return a.prototype=Object.assign(Object.create(r.prototype),{constructor:a,fieldDefinitions:new i([new e(s.inputOutput,"metadata",new t.SFNode),new e(s.initializeOnly,"solid",new t.SFBool(!0)),new e(s.initializeOnly,"ccw",new t.SFBool(!0)),new e(s.inputOutput,"crossSectionCurve",new t.SFNode),new e(s.inputOutput,"trajectoryCurve",new t.SFNode)]),getTypeName:function(){return"NurbsSweptSurface"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"geometry"},initialize:function(){r.prototype.initialize.call(this),this.crossSectionCurve_.addInterest("set_crossSectionCurve__",this),this.trajectoryCurve_.addInterest("set_trajectoryCurve__",this);var t=this.extrusion;t.beginCap_=!1,t.endCap_=!1,t.solid_=!0,t.ccw_=!0,t.convex_=!0,t.creaseAngle_=Math.PI,t.setup(),t.crossSection_.setTainted(!0),t.spine_.setTainted(!0),this.set_crossSectionCurve__(),this.set_trajectoryCurve__()},set_crossSectionCurve__:function(){this.crossSectionCurveNode&&this.crossSectionCurveNode.removeInterest("requestRebuild",this),this.crossSectionCurveNode=o(s.X3DNurbsControlCurveNode,this.crossSectionCurve_),this.crossSectionCurveNode&&this.crossSectionCurveNode.addInterest("requestRebuild",this)},set_trajectoryCurve__:function(){this.trajectoryCurveNode&&this.trajectoryCurveNode.rebuild_.removeInterest("requestRebuild",this),this.trajectoryCurveNode=o(s.NurbsCurve,this.trajectoryCurve_),this.trajectoryCurveNode&&this.trajectoryCurveNode.rebuild_.addInterest("requestRebuild",this)},build:function(){if(this.crossSectionCurveNode&&this.trajectoryCurveNode){var t=this.extrusion;if(t.crossSection_=this.crossSectionCurveNode.tessellate(),t.spine_=this.trajectoryCurveNode.tessellate(),t.rebuild(),this.getColors().assign(t.getColors()),this.getTexCoords().assign(t.getTexCoords()),this.getNormals().assign(t.getNormals()),this.getVertices().assign(t.getVertices()),this.getMultiTexCoords().push(this.getTexCoords()),!this.ccw_.getValue())for(var e=this.getNormals(),i=0,n=e.length;i<n;++i)e[i]=-e[i];this.setSolid(this.solid_.getValue()),this.setCCW(this.ccw_.getValue())}}}),a}),t("x_ite/Components/NURBS/NurbsSwungSurface",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Geometry3D/Extrusion","x_ite/Components/NURBS/X3DParametricGeometryNode","x_ite/Bits/X3DConstants","x_ite/Bits/X3DCast"],function(t,e,i,n,r,s,o){"use strict";function a(t){r.call(this,t),this.addType(s.NurbsSwungSurface),this.extrusion=new n(t)}return a.prototype=Object.assign(Object.create(r.prototype),{constructor:a,fieldDefinitions:new i([new e(s.inputOutput,"metadata",new t.SFNode),new e(s.initializeOnly,"solid",new t.SFBool(!0)),new e(s.initializeOnly,"ccw",new t.SFBool(!0)),new e(s.inputOutput,"profileCurve",new t.SFNode),new e(s.inputOutput,"trajectoryCurve",new t.SFNode)]),getTypeName:function(){return"NurbsSwungSurface"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"geometry"},initialize:function(){r.prototype.initialize.call(this),this.profileCurve_.addInterest("set_profileCurve__",this),this.trajectoryCurve_.addInterest("set_trajectoryCurve__",this);var t=this.extrusion;t.beginCap_=!1,t.endCap_=!1,t.solid_=!0,t.ccw_=!0,t.convex_=!0,t.creaseAngle_=Math.PI,t.setup(),t.crossSection_.setTainted(!0),t.spine_.setTainted(!0),this.set_profileCurve__(),this.set_trajectoryCurve__()},set_profileCurve__:function(){this.profileCurveNode&&this.profileCurveNode.removeInterest("requestRebuild",this),this.profileCurveNode=o(s.X3DNurbsControlCurveNode,this.profileCurve_),this.profileCurveNode&&this.profileCurveNode.addInterest("requestRebuild",this)},set_trajectoryCurve__:function(){this.trajectoryCurveNode&&this.trajectoryCurveNode.removeInterest("requestRebuild",this),this.trajectoryCurveNode=o(s.X3DNurbsControlCurveNode,this.trajectoryCurve_),this.trajectoryCurveNode&&this.trajectoryCurveNode.addInterest("requestRebuild",this)},build:function(){if(this.profileCurveNode&&this.trajectoryCurveNode){var t=this.extrusion;if(t.crossSection_=this.profileCurveNode.tessellate(),t.spine_=this.trajectoryCurveNode.tessellate(!0),t.rebuild(),this.getColors().assign(t.getColors()),this.getTexCoords().assign(t.getTexCoords()),this.getNormals().assign(t.getNormals()),this.getVertices().assign(t.getVertices()),this.getMultiTexCoords().push(this.getTexCoords()),!this.ccw_.getValue())for(var e=this.getNormals(),i=0,n=e.length;i<n;++i)e[i]=-e[i];this.setSolid(this.solid_.getValue()),this.setCCW(this.ccw_.getValue())}}}),a}),t("x_ite/Components/NURBS/NurbsTextureCoordinate",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/Core/X3DNode","x_ite/Bits/X3DConstants","standard/Math/Numbers/Vector4"],function(t,e,i,n,r,s){"use strict";function o(t){n.call(this,t),this.addType(r.NurbsTextureCoordinate)}return o.prototype=Object.assign(Object.create(n.prototype),{constructor:o,fieldDefinitions:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.initializeOnly,"uOrder",new t.SFInt32(3)),new e(r.initializeOnly,"vOrder",new t.SFInt32(3)),new e(r.initializeOnly,"uDimension",new t.SFInt32),new e(r.initializeOnly,"vDimension",new t.SFInt32),new e(r.initializeOnly,"uKnot",new t.MFDouble),new e(r.initializeOnly,"vKnot",new t.MFDouble),new e(r.inputOutput,"weight",new t.MFFloat),new e(r.inputOutput,"controlPoint",new t.MFVec2f)]),getTypeName:function(){return"NurbsTextureCoordinate"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"texCoord"},initialize:function(){n.prototype.initialize.call(this)},getControlPoints:function(){for(var t=[],e=0,i=this.uDimension_.getValue();e<i;++e){var n=[];t.push(n);for(var r=0,o=this.vDimension_.getValue();r<o;++r){var a=this.controlPoint_[r*i+e];n.push(new s(a.x,a.y,0,1))}}return t},isValid:function(){return!(this.uOrder_.getValue()<2)&&(!(this.vOrder_.getValue()<2)&&(!(this.uDimension_.getValue()<this.uOrder_.getValue())&&(!(this.vDimension_.getValue()<this.vOrder_.getValue())&&this.controlPoint_.length===this.uDimension_.getValue()*this.vDimension_.getValue())))}}),o}),t("x_ite/Components/NURBS/NurbsTrimmedSurface",["x_ite/Fields","x_ite/Basic/X3DFieldDefinition","x_ite/Basic/FieldDefinitionArray","x_ite/Components/NURBS/X3DNurbsSurfaceGeometryNode","x_ite/Bits/X3DConstants"],function(t,e,i,n,r){"use strict";function s(t){n.call(this,t),this.addType(r.NurbsTrimmedSurface)}return s.prototype=Object.assign(Object.create(n.prototype),{constructor:s,fieldDefinitions:new i([new e(r.inputOutput,"metadata",new t.SFNode),new e(r.initializeOnly,"solid",new t.SFBool(!0)),new e(r.inputOutput,"uTessellation",new t.SFInt32),new e(r.inputOutput,"vTessellation",new t.SFInt32),new e(r.initializeOnly,"uClosed",new t.SFBool),new e(r.initializeOnly,"vClosed",new t.SFBool),new e(r.initializeOnly,"uOrder",new t.SFInt32(3)),new e(r.initializeOnly,"vOrder",new t.SFInt32(3)),new e(r.initializeOnly,"uDimension",new t.SFInt32),new e(r.initializeOnly,"vDimension",new t.SFInt32),new e(r.initializeOnly,"uKnot",new t.MFDouble),new e(r.initializeOnly,"vKnot",new t.MFDouble),new e(r.inputOutput,"weight",new t.MFDouble),new e(r.inputOutput,"texCoord",new t.SFNode),new e(r.inputOutput,"controlPoint",new t.SFNode),new e(r.inputOnly,"addTrimmingContour",new t.MFNode),new e(r.inputOnly,"removeTrimmingContour",new t.MFNode),new e(r.inputOutput,"trimmingContour",new t.MFNode)]),getTypeName:function(){return"NurbsTrimmedSurface"},getComponentName:function(){return"NURBS"},getContainerField:function(){return"geometry"}}),s}),e(["x_ite/Configuration/SupportedNodes","x_ite/Components/NURBS/Contour2D","x_ite/Components/NURBS/ContourPolyline2D","x_ite/Components/NURBS/CoordinateDouble","x_ite/Components/NURBS/NurbsCurve","x_ite/Components/NURBS/NurbsCurve2D","x_ite/Components/NURBS/NurbsOrientationInterpolator","x_ite/Components/NURBS/NurbsPatchSurface","x_ite/Components/NURBS/NurbsPositionInterpolator","x_ite/Components/NURBS/NurbsSet","x_ite/Components/NURBS/NurbsSurfaceInterpolator","x_ite/Components/NURBS/NurbsSweptSurface","x_ite/Components/NURBS/NurbsSwungSurface","x_ite/Components/NURBS/NurbsTextureCoordinate","x_ite/Components/NURBS/NurbsTrimmedSurface","x_ite/Components/NURBS/X3DNurbsControlCurveNode","x_ite/Components/NURBS/X3DNurbsSurfaceGeometryNode","x_ite/Components/NURBS/X3DParametricGeometryNode"],function(t,e,i,n,r,s,o,a,u,l,h,c,d,g,p,f,m,_){"use strict";var y={Contour2D:e,ContourPolyline2D:i,CoordinateDouble:n,NurbsCurve:r,NurbsCurve2D:s,NurbsOrientationInterpolator:o,NurbsPatchSurface:a,NurbsPositionInterpolator:u,NurbsSet:l,NurbsSurfaceInterpolator:h,NurbsSweptSurface:c,NurbsSwungSurface:d,NurbsTextureCoordinate:g,NurbsTrimmedSurface:p},v={X3DNurbsControlCurveNode:f,X3DNurbsSurfaceGeometryNode:m,X3DParametricGeometryNode:_};for(var b in y)t.addType(b,y[b]);for(var b in v)t.addAbstractType(b,v[b]);return y}),t("components/nurbs",function(){})}();
